<script>
(function(){
  const table = document.getElementById('shippingTable');
  if(!table) return;
  const rows = Array.from(table.querySelectorAll('tr')).filter(r => r.querySelector('input[type="checkbox"]'));

  // 依第 2 欄 ship-fee 自動補上 +金額徽章
  rows.forEach(r => {
    const labelCell = r.querySelector('td:nth-child(1)');
    const feeCell   = r.querySelector('.ship-fee, td:nth-child(2)');
    if(labelCell && feeCell && !labelCell.querySelector('.ship-price')){
      const badge = document.createElement('span');
      badge.className = 'ship-price';
      const feeText = (feeCell.textContent || '').trim().replace(/[^\d.]/g,'');
      badge.textContent = '+' + (feeText || '0');
      labelCell.appendChild(badge);
    }
  });

  // 讓兩顆標籤字寬一致（視覺等寬）
  const labels = table.querySelectorAll('.ship-label');
  const maxCh  = Math.max(...Array.from(labels).map(l => l.textContent.trim().length));
  labels.forEach(l => { l.style.minWidth = maxCh + 'ch'; });

  function setSelected(row){
    rows.forEach(r=>{
      const cb=r.querySelector('input[type="checkbox"]');
      const isThis = (r===row);
      r.classList.toggle('selected', isThis);
      if(cb){
        cb.checked = isThis;
        cb.setAttribute('aria-checked', isThis ? 'true' : 'false');
      }
    });
    // 觸發你原本的金額計算（若你用的是 change 事件）
    const cb = row.querySelector('input[type="checkbox"]');
    if(cb){
      const ev = new Event('change', {bubbles:true});
      cb.dispatchEvent(ev);
    }
  }

  // 若原本就有預設勾選，延用；否則預設第一個
  const preset = rows.find(r => r.querySelector('input[type="checkbox"]').checked);
  setSelected(preset || rows[0]);

  rows.forEach(r=>{
    r.setAttribute('tabindex', '0');
    r.addEventListener('click', ()=> setSelected(r));
    r.addEventListener('keydown', (e)=>{
      if(e.key === 'Enter' || e.key === ' '){
        e.preventDefault(); setSelected(r);
      }
    });
  });
})();
</script>

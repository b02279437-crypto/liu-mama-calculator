<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>LIU MAMA Order</title>

<!-- 字體 -->
<link href="https://fonts.googleapis.com/css2?family=Amatic+SC:wght@700&family=Noto+Serif+TC:wght@500;600&display=swap" rel="stylesheet">
<!-- 截圖功能 -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>

<!-- 預載圖片（路徑不變） -->
<link rel="preload" as="image" href="https://raw.githubusercontent.com/b02279437-crypto/liu-mama-calculator/main/logo.png">
<link rel="preload" as="image" href="https://raw.githubusercontent.com/b02279437-crypto/liu-mama-calculator/main/LOGO2-removebg-preview.png">

<style>
:root{
  --milk:#E8D9C4; --navy:#1E4F7B; --bg:#f7f6f2; --gray-blue:#7f9bb3; --milk-solid:#e9e3d7;
  --ease:cubic-bezier(.22,.61,.36,1); --ease-soft:cubic-bezier(.2,.7,.2,1);
  --t-fast:.24s; --t-base:.6s; --t-slow:1.2s;

  --control-h:44px;
  --qty-btn-w:36px; --qty-disp-w:56px;

  --crayon-blue:#54677C; --crayon-blue-ink:#3C5168;

  /* 一行優惠（純文字、無底框） */
  --promo-text:#2B3E53;   /* 墨藍灰 */
  --promo-red:#A6413C;    /* 胭脂紅（$299 與文案同色） */
}

/* ===== 全域 ===== */
html{-webkit-text-size-adjust:100%;}
*{ -webkit-tap-highlight-color: transparent; box-sizing:border-box; }
button{ touch-action: manipulation; }

html,body{
  margin:0; padding:0; height:100%;
  background-color:var(--bg); color:#2c3e50;
  font-family:'Noto Serif TC','Microsoft JhengHei',serif; /* 中文統一 */
  text-align:center; overflow-x:hidden; scroll-behavior:smooth;
}

/* 確保子元素繼承中文字體 */
table, .ship-card, .btn, .account-box, .promo-inline, input, label, small, p, div, span {
  font-family:inherit;
}

/* 表格數字、總額數字等對齊 */
table td,table th,.total,#qty1,#formReminder,.ship-price{
  font-variant-numeric:tabular-nums lining-nums;
  font-feature-settings:"tnum" 1,"lnum" 1;
  letter-spacing:.02em;
}

/* ===== 開場動畫 ===== */
#intro{
  position:fixed; inset:0; background-color:var(--bg);
  display:flex; flex-direction:column; align-items:center; justify-content:flex-start;
  padding-top:12vh; z-index:9999; opacity:1; transition:opacity var(--t-slow) var(--ease);
}
#intro.fade-out{opacity:0; pointer-events:none;}
#intro-logo{
  width:clamp(360px, 92vw, 700px);
  opacity:0; transform:scale(.99);
  transition:opacity calc(var(--t-slow)*1.1) var(--ease), transform calc(var(--t-slow)*1.3) var(--ease);
}
#intro-logo.show{opacity:1; transform:scale(1.04);}
#intro-logo.hide{opacity:0; transform:scale(1.04); transition:opacity var(--t-base) var(--ease);}
#intro-hero{
  width:clamp(260px,60vw,380px);
  opacity:0; transform:translateY(8px);
  transition:opacity var(--t-base) var(--ease), transform var(--t-base) var(--ease);
  margin:18px auto -72px; filter:drop-shadow(0 10px 14px rgba(0,0,0,0.15));
}
#intro-hero.show{opacity:1; transform:translateY(0);}
#intro-text{
  font-weight:500; color:#333; font-size:15px; line-height:1.9;
  opacity:0; white-space:pre-line; margin-top:-38px; letter-spacing:.5px;
  transition:opacity var(--t-base) var(--ease);
}
#intro-text.show{opacity:1;}
#startBtn{
  margin-top:16px; padding:12px 34px; font-size:26px;
  font-family:'Amatic SC',cursive; letter-spacing:2px; color:var(--navy);
  background:rgba(255,255,255,.62); border:1px solid rgba(255,255,255,.70); border-radius:999px;
  -webkit-backdrop-filter:blur(14px) saturate(1.06); backdrop-filter:blur(14px) saturate(1.06);
  box-shadow: inset 0 1px 0 rgba(255,255,255,.65), 0 10px 24px rgba(30,79,123,.14);
  cursor:pointer; position:relative; isolation:isolate;
  opacity:0; transform:translateY(10px);
  transition:opacity var(--t-base) var(--ease), transform var(--t-fast) var(--ease), filter .25s var(--ease);
}
#startBtn.show{opacity:1; transform:translateY(0);}
#startBtn:hover{ transform:translateY(-2px); filter:brightness(1.03); }
#startBtn:active{ transform:translateY(-1px); }
#startBtn::after{
  content:""; position:absolute; inset:auto; width:10px; height:10px; border-radius:50%;
  background:radial-gradient(circle, rgba(30,79,123,.18) 0%, rgba(30,79,123,0) 70%);
  transform:translate(-50%,-50%) scale(1); opacity:0; pointer-events:none;
}
#startBtn.rippling::after{ left:var(--rx); top:var(--ry); animation:rippleInk .8s var(--ease-soft); }
@keyframes rippleInk{ 0%{opacity:.35; transform:translate(-50%,-50%) scale(1);} 100%{opacity:0; transform:translate(-50%,-50%) scale(35);} }

/* ===== 主內容 ===== */
main{opacity:0; visibility:hidden; transition:opacity var(--t-slow) var(--ease);}
main.show{opacity:1; visibility:visible;}
h2{
  font-size:90px; font-weight:900; color:#1E4F7B;
  margin:28px 0 6px 0;
  animation:titleFade 1.4s var(--ease) forwards;
}
@keyframes titleFade{ 0%{opacity:0; transform:translateY(12px) scale(.98);} 60%{opacity:.8; transform:translateY(2px) scale(1.01);} 100%{opacity:1; transform:translateY(0) scale(1);} }
h2 .english{font-family:'Amatic SC',cursive; font-weight:900;}
.section-title{font-size:14px; color:#555; margin:10px 0 6px;}
.reveal{opacity:0; transform:translateY(34px); transition:opacity .9s var(--ease), transform .9s var(--ease);}
.reveal.in{opacity:1; transform:translateY(0);}

/* ===== 一行優惠（純文字、無底框） ===== */
.promo-inline{
  width:min(820px, 94vw);
  margin:8px auto 12px;
  font-size:13.8px; line-height:1.75;
  color:var(--promo-text);
  letter-spacing:.2px;
}
.promo-inline .price-red{ color:var(--promo-red); font-weight:700; letter-spacing:.25px; font-size:.92em; }
.promo-days{ font-weight:800; display:inline-block; transform-origin:50% 60%; }
.promo-days.animate{ animation: promoBounce .85s var(--ease); }
@keyframes promoBounce{ 0%{transform:scale(1);} 45%{transform:scale(1.08);} 100%{transform:scale(1);} }
@media (max-width:480px){ .promo-inline{ font-size:12.9px; width:96%; } }

/* ===== 訂購資訊卡片 ===== */
.input-container{
  max-width:500px; margin:0 auto 30px; text-align:left;
  background:#fff; padding:25px 28px; border-radius:16px;
  box-shadow:0 6px 22px rgba(0,0,0,.05);
}
.input-group{display:flex; flex-direction:column; gap:5px; margin-bottom:18px;}
.input-group label{font-size:14px; color:#333;}
.input-group input{
  font-size:16px; height:var(--control-h); line-height:calc(var(--control-h) - 2px);
  padding:0 12px; border:1px solid #ccc; border-radius:8px; background:#fafafa;
  transition:border-color var(--t-fast) var(--ease), box-shadow var(--t-fast) var(--ease);
}
.input-group input:focus{border-color:#1E4F7B; background:#fff; box-shadow:0 0 6px rgba(30,79,123,.2);}
.input-error{border-color:#e74c3c !important;}
.error-hint{font-size:12px; color:#c0392b; margin-top:2px;}

/* ===== 表格 ===== */
table{
  width:90%; max-width:500px; margin:15px auto;
  border-collapse:separate; border-spacing:0; background:#fff; border-radius:16px; overflow:hidden;
  box-shadow:0 2px 10px rgba(0,0,0,.08); font-size:15px; table-layout:fixed; text-align:center;
}
th,td{ padding:10px; border-bottom:1px solid #e9eef2; vertical-align:middle; white-space:nowrap; }
th{ background-color:var(--gray-blue); color:#fff; font-weight:500; }
.col-item{ width:auto; } .col-price{ width:110px; } .col-action{ width:148px; }
#productTable td:nth-child(3), #productTable th:nth-child(3){ padding-left:6px; padding-right:6px; }
#productTable{ margin:15px auto 28px; }

/* 商品名稱：與 711超商取貨 同尺寸/顏色/粗細 */
.item-title{ font-size:15px; line-height:1.35; font-weight:600; color:#2d3b4a; }

/* 表格內價格組合：原價刪除線 + 現價紅色（較小） */
.price-old{
  display:inline-block; margin-right:6px;
  font-size:13px; color:#9aa3ad; text-decoration:line-through;
  vertical-align:baseline;
}
.price-now{
  font-size:14px; font-weight:700; color:var(--promo-red);
  vertical-align:baseline;
}

/* 隱藏原生 select */
#qty1[hidden]{ display:none !important; }

/* ===== Stepper ===== */
.qty-stepper{
  display:inline-flex; align-items:center; height:var(--control-h);
  border:1px solid #ccc; border-radius:8px; background:#fff;
  width: calc(var(--qty-btn-w)*2 + var(--qty-disp-w) + 2px);
  max-width:100%;
}
.qty-btn{
  width:var(--qty-btn-w); height:100%;
  border:none; background:#f3f3f3; cursor:pointer; font-size:20px; line-height:1;
  display:inline-flex; align-items:center; justify-content:center;
  transition:background-color var(--t-fast) var(--ease), transform var(--t-fast) var(--ease);
  user-select:none;
}
.qty-btn:hover{ background:#ececec; }
.qty-btn:active{ transform:translateY(0); }
.qty-input{
  width:var(--qty-disp-w); height:100%;
  border:none; border-left:1px solid #e6e6e6; border-right:1px solid #e6e6e6;
  text-align:center; font-size:16px; background:#fff;
}
.qty-stepper:focus-within{ box-shadow:0 0 0 3px rgba(30,79,123,.15); border-color:#9bb7d3; }
.qty-btn:focus-visible, .qty-input:focus-visible{ outline:2px solid rgba(30,79,123,.6); outline-offset:2px; }

/* ===== 寄送方式 ===== */
.ship-wrap{ width:90%; max-width:500px; margin:8px auto 12px; display:flex; gap:12px; }
.ship-card{
  --glow: rgba(30,79,123,.14);
  position:relative; flex:1; border-radius:14px;
  background:linear-gradient(180deg, rgba(255,255,255,.68), rgba(255,255,255,.50));
  backdrop-filter:blur(12px) saturate(1.04); -webkit-backdrop-filter:blur(12px) saturate(1.04);
  border:1px solid rgba(255,255,255,.55);
  box-shadow:inset 0 1px 0 rgba(255,255,255,.75), 0 8px 22px rgba(20,40,60,.12);
  padding:14px 12px; cursor:pointer; user-select:none;
  transition: transform var(--t-fast) var(--ease), box-shadow var(--t-base) var(--ease), border-color var(--t-fast) var(--ease), filter var(--t-fast) var(--ease);
  display:flex; flex-direction:column; align-items:center; gap:6px;
}
.ship-card:hover{ transform:translateY(-1px); filter:brightness(1.02); }
.ship-card:active{ transform:translateY(0); }
.ship-card::after{
  content:""; position:absolute; inset:0; pointer-events:none; border-radius:inherit;
  background:
    radial-gradient(120% 70% at 50% -20%, rgba(255,255,255,.55), transparent 55%),
    radial-gradient(120% 90% at 50% 120%, var(--glow), transparent 60%);
  opacity:.18; transition:opacity var(--t-fast) var(--ease);
}
.ship-card input{ position:absolute; opacity:0; inset:0; pointer-events:none; }
.ship-title,.ship-price{ font-size:15px; line-height:1.35; letter-spacing:.2px; color:#2d3b4a; }
.ship-title{ font-weight:600; }
.ship-price{ font-weight:500; color:#4f5f70; }
.ship-card:has(input:checked), .ship-card.selected{
  border-color:rgba(30,79,123,.55);
  box-shadow: inset 0 1px 0 rgba(255,255,255,.75), 0 12px 32px rgba(30,79,123,.18), 0 0 0 6px rgba(30,79,123,.06);
  filter:brightness(1.06);
}
.ship-card:has(input:checked)::after{ opacity:.28; }
.ship-card input:checked ~ .ship-title, .ship-card input:checked ~ .ship-price{ color:#1E4F7B; text-shadow:0 0 1px rgba(30,79,123,.06); }

/* ===== Total ===== */
.total{
  font-family:'Amatic SC', cursive;
  font-size:30px; font-weight:900; letter-spacing:2.5px; color:#1E4F7B;
  margin-top:16px; position:relative; display:inline-block;
  padding:6px 18px; opacity:0; transform:translateY(10px) scale(.96);
  transition:opacity var(--t-slow) var(--ease), transform var(--t-slow) var(--ease);
  z-index:0; isolation:isolate;
}
.total.show{opacity:1; transform:translateY(0) scale(1);}
.total::before{
  content:""; position:absolute; left:0; top:50%; width:100%; height:64%;
  transform:translateY(-50%) rotate(-1.2deg) scale(1);
  background:linear-gradient(120deg, rgba(255,229,185,.65) 0%, rgba(255,215,160,.5) 100%);
  border-radius:12px; z-index:-1;
  filter:blur(1px) saturate(1.05); opacity:.55; mix-blend-mode:soft-light;
}
@keyframes totalUpdate{ 0%{transform:scale(1);} 50%{transform:scale(1.04);} 100%{transform:scale(1);} }
.total.animate{ animation: totalUpdate .8s var(--ease); }
@keyframes glowPulse{
  0%{opacity:.4; transform:translateY(-50%) rotate(-1.2deg) scale(1); filter:blur(1px) saturate(1.05) brightness(1);}
  50%{opacity:.85; transform:translateY(-50%) rotate(-1.2deg) scale(1.04); filter:blur(1.6px) saturate(1.15) brightness(1.08);}
  100%{opacity:.5; transform:translateY(-50%) rotate(-1.2deg) scale(1); filter:blur(1px) saturate(1.05) brightness(1);}
}
.total.glow::before{ animation: glowPulse 1.8s var(--ease) 1; }

/* ===== 匯款資訊卡片 ===== */
.account-box{
  width:85%; max-width:350px; margin:25px auto 0;
  background:rgba(255,255,255,0.55);
  -webkit-backdrop-filter:blur(12px) brightness(1.05);
  backdrop-filter:blur(12px) brightness(1.05);
  border:1px solid rgba(255,255,255,0.4);
  color:#333; padding:16px; border-radius:16px; font-size:13px;
  box-shadow:0 8px 24px rgba(0,0,0,0.07);
}
.account-box h3{margin:8px 0; font-weight:600; font-size:15px; color:#44566C; letter-spacing:.5px;}

/* ===== 按鈕 ===== */
.btn{
  display:inline-flex; align-items:center; gap:8px;
  padding:12px 22px; border-radius:999px; border:1px solid transparent;
  font:600 15px 'Noto Serif TC','Microsoft JhengHei',serif;
  letter-spacing:.2px; cursor:pointer; user-select:none;
  transition:transform .2s var(--ease), box-shadow .3s var(--ease),
             background-color .2s var(--ease), border-color .2s var(--ease), filter .2s;
}
.btn:hover{ transform:translateY(-1px); }
.btn:active{ transform:translateY(0); }
.btn:focus-visible{ outline:2px solid rgba(30,79,123,.4); outline-offset:2px; }

/* 蠟筆塊底 */
.btn-crayon{
  color:#fff; background:var(--crayon-blue);
  border:1px solid var(--crayon-blue-ink);
  border-radius:22px 20px 24px 21px / 21px 24px 20px 22px;
  box-shadow:0 8px 18px rgba(60,81,104,.22), inset 0 1px 0 rgba(255,255,255,.18);
  position:relative; overflow:hidden;
}
.btn-crayon::before{
  content:""; position:absolute; inset:0; opacity:.18; pointer-events:none;
  background:
    repeating-linear-gradient(12deg, rgba(255,255,255,.08) 0 2px, rgba(255,255,255,0) 2px 6px),
    repeating-linear-gradient(-8deg, rgba(0,0,0,.04) 0 1px, rgba(0,0,0,0) 1px 5px);
}
.btn-crayon:hover{ filter:brightness(1.06) saturate(1.03); }

/* 手繪描邊 */
.btn-sketch{
  color:var(--navy); background:transparent;
  border:2px solid var(--navy);
  border-radius:22px 18px 24px 20px / 20px 24px 18px 22px;
  box-shadow:0 2px 0 rgba(30,79,123,.08);
  position:relative;
}
.btn-sketch::after{
  content:""; position:absolute; inset:3px; border-radius:inherit;
  border:1px dashed rgba(30,79,123,.45); pointer-events:none;
}
.btn-sketch:hover{ filter:brightness(1.02); }

/* ===== 提示字 ===== */
#formReminder{
  font-size:14px; color:#555; margin-top:16px;
  opacity:0; transform:translateY(14px);
  transition:opacity .8s var(--ease), transform .8s var(--ease);
}
#formReminder.in{ opacity:1; transform:translateY(0); }

/* ===== Toast ===== */
.toast{
  position:fixed; left:50%; bottom:22px; transform:translateX(-50%) translateY(20px);
  min-width:260px; max-width:92vw;
  color:#1E4F7B;
  background:rgba(255,255,255,.75);
  border:1px solid rgba(30,79,123,.18);
  border-radius:12px; padding:12px 16px;
  font-size:14px; font-weight:600;
  -webkit-backdrop-filter: blur(12px) saturate(1.1);
  backdrop-filter: blur(12px) saturate(1.1);
  box-shadow:0 10px 28px rgba(0,0,0,0.12), inset 0 1px 0 rgba(255,255,255,.6);
  opacity:0; pointer-events:none; z-index:99999;
  transition:opacity .5s var(--ease), transform .5s var(--ease);
}
.toast::before{
  content:""; position:absolute; left:0; top:0; bottom:0; width:6px;
  border-top-left-radius:12px; border-bottom-left-radius:12px;
  background:linear-gradient(180deg, #3a6aa1, #1E4F7B);
  box-shadow:0 0 0 1px rgba(30,79,123,.18) inset;
}
.toast.show{opacity:1; transform:translateX(-50%) translateY(0);}

/* ===== 手機優化 ===== */
@media (max-width:480px){
  :root{ --qty-btn-w: 30px; --qty-disp-w: 44px; }
  h2{font-size:60px;}
  table{font-size:13.5px; width:96%;}
  .col-price { width:100px; }
  .col-action{ width:130px; }
  #productTable td:nth-child(3), #productTable th:nth-child(3){ padding-left:4px; padding-right:4px; }

  .input-container{width:90%; padding:18px;}
  .account-box{font-size:12.5px; width:90%;}
  .btn{ padding:11px 18px; font-size:15px; }
  #intro-hero{width:clamp(240px, 68vw, 360px); margin:14px auto -66px;}
  #intro-text{margin-top:-34px; line-height:1.9;}
  #startBtn{ margin-top:14px; }
  .ship-wrap{width:96%;}
}

/* ===== 無動化偏好 ===== */
@media (prefers-reduced-motion: reduce){
  *{ animation:none !important; transition:none !重要; }
  #startBtn::after{ display:none !重要; }
}
</style>
</head>

<body>
<!-- ===== 開場 ===== -->
<div id="intro">
  <img id="intro-logo" decoding="async" loading="eager"
       src="https://raw.githubusercontent.com/b02279437-crypto/liu-mama-calculator/main/logo.png" alt="Logo">
  <img id="intro-hero" decoding="async" loading="eager"
       src="https://raw.githubusercontent.com/b02279437-crypto/liu-mama-calculator/main/LOGO2-removebg-preview.png" alt="Liu Mama Secondary Logo">

  <div id="intro-text">
2015年遠赴四川成都， 
學習正宗麻辣鍋底與紅油煉製。
手工慢炒堆疊香氣，濃郁而不膩。

劉嘛麻，一鍋來自初心的麻辣香氣，
陪你溫暖每一餐。
  </div>
  <button id="startBtn">Start Order</button>
</div>

<!-- ===== 主內容 ===== -->
<main id="mainContent" aria-describedby="formReminder">
  <h2 id="pageTitle"><span class="english">LIU MAMA Order</span></h2>

  <section class="reveal left">
    <p class="section-title">請填寫訂購人資訊</p>
    <div class="input-container">
      <div class="input-group">
        <label for="customerName">訂購人姓名</label>
        <input type="text" id="customerName" placeholder="請輸入姓名"
               autocomplete="name" enterkeyhint="next">
        <small class="error-hint" id="errName" hidden></small>
      </div>
      <div class="input-group">
        <label for="customerPhone">訂購人電話</label>
        <input type="text" id="customerPhone" placeholder="請輸入電話"
               inputmode="numeric" pattern="[0-9]*" maxlength="10" enterkeyhint="next" autocomplete="tel">
        <small class="error-hint" id="errPhone" hidden></small>
      </div>
      <div class="input-group">
        <label for="customerEmail">訂購人 Email</label>
        <input type="email" id="customerEmail" placeholder="請輸入 Email"
               autocomplete="email" enterkeyhint="done" inputmode="email">
        <small class="error-hint" id="errEmail" hidden></small>
      </div>
    </div>
  </section>

  <section class="reveal right">
    <p class="section-title">請選擇購買數量與寄送方式，系統將自動計算金額</p>

    <!-- 一行優惠（純文字、無底框） -->
    <p id="promoInline" class="promo-inline" hidden>
      先嚐一鍋就愛上：11/17–12/17 開賣價 <strong class="price-red">$299</strong>
      &nbsp; 倒數 <strong class="promo-days" id="promoDays">36 天</strong>。
    </p>

    <table id="productTable">
      <colgroup>
        <col class="col-item"><col class="col-price"><col class="col-action">
      </colgroup>
      <tr><th>品項</th><th>價格</th><th>數量</th></tr>
      <tr>
        <td>
          <span class="item-title">手炒麻辣鍋底</span><br>
          <small>(2人份)</small>
        </td>
        <td>
          <span class="price-old">$320</span>
          <span class="price-now">$299</span>
        </td>
        <td>
          <div class="qty-stepper" role="group" aria-label="數量">
            <button type="button" class="qty-btn" id="qtyMinus" aria-label="減少">−</button>
            <input id="qtyInput" class="qty-input" type="text" inputmode="numeric" pattern="[0-9]*" maxlength="2"
                   value="0" role="spinbutton" aria-valuemin="0" aria-valuemax="35" aria-valuenow="0" aria-live="polite">
            <button type="button" class="qty-btn" id="qtyPlus" aria-label="增加">＋</button>
          </div>
          <select id="qty1" onchange="calculate()" aria-label="數量" hidden></select>
        </td>
      </tr>
    </table>
  </section>

  <!-- 寄送方式 -->
  <section class="reveal left">
    <div class="ship-wrap" role="radiogroup" aria-label="寄送方式">
      <label class="ship-card" for="ship711">
        <input type="radio" name="shipMethod" id="ship711" value="711">
        <div class="ship-title">711超商取貨</div>
        <div class="ship-price">$60</div>
      </label>
      <label class="ship-card" for="shipPost">
        <input type="radio" name="shipMethod" id="shipPost" value="post">
        <div class="ship-title">宅配到家</div>
        <div class="ship-price">$120</div>
      </label>
    </div>

    <div class="total" id="total" role="status" aria-live="polite" aria-atomic="true">Total Amount: $0</div>
  </section>

  <!-- 匯款資訊 + 按鈕 -->
  <section class="reveal right">
    <div class="account-box">
      <h3>請匯款至以下帳戶:</h3>
      <p>台新銀行 812　帳號：<span id="accountNumber">123456789</span> 陳慧珍</p>
      <button id="copyBtn" class="btn btn-crayon" onclick="copyAccount()">複製匯款帳號</button>
    </div>

    <div id="buttonContainer" style="display:flex; justify-content:center; gap:12px; flex-wrap:wrap; margin-top:32px;">
      <button id="screenshotBtn" class="btn btn-crayon" onclick="screenshotOrder()">保存訂單截圖</button>
      <button id="formBtn" class="btn btn-sketch" onclick="goToForm()">下一步：填寫寄送資訊</button>
    </div>
    <p id="formReminder">煩請先匯款後,一定要按下一步填寫寄送資訊!</p>
  </section>
</main>

<!-- Toast -->
<div id="toast" class="toast" aria-live="polite" aria-atomic="true"></div>

<script>
/* ===== 圖片載入 ===== */
function imgReady(el){
  if(el.complete){
    if('decode' in el){ return el.decode().catch(()=>{}); }
    return Promise.resolve();
  }
  return new Promise(res=>{
    el.addEventListener('load', res, {once:true});
    el.addEventListener('error', res, {once:true});
  });
}
async function startIntroSequence(){
  const logo=document.getElementById('intro-logo');
  const hero=document.getElementById('intro-hero');
  const text=document.getElementById('intro-text');
  const btn=document.getElementById('startBtn');
  const maxWait=new Promise(r=>setTimeout(r,4000));
  await Promise.race([Promise.all([imgReady(logo), imgReady(hero)]), maxWait]);
  requestAnimationFrame(()=>{
    logo.classList.add('show');
    setTimeout(()=>logo.classList.add('hide'),2000);
    setTimeout(()=>{
      logo.style.display='none';
      hero.classList.add('show');
      text.classList.add('show');
    },3200);
    setTimeout(()=>btn.classList.add('show'),4800);
  });
}

/* ===== 初始化 ===== */
window.addEventListener('DOMContentLoaded',()=>{
  // 建立隱藏 select 的 0–35
  const select=document.getElementById('qty1');
  for(let i=0;i<=35;i++){ const o=document.createElement('option'); o.value=i; o.textContent=i; select.appendChild(o); }
  select.value="0";

  buildQty();
  calculate(true);
  startIntroSequence();

  // 進主頁
  const intro=document.getElementById('intro');
  const btn=document.getElementById('startBtn');
  const main=document.getElementById('mainContent');
  btn.addEventListener('click',(e)=>{
    triggerRipple(e);
    intro.classList.add('fade-out');
    setTimeout(()=>{
      intro.style.display='none';
      main.classList.add('show');
      document.querySelectorAll('.reveal').forEach((el,i)=>setTimeout(()=>el.classList.add('in'), i*180));
      setTimeout(()=>document.querySelector('.total').classList.add('show'),1000);
      setTimeout(()=>document.getElementById('formReminder').classList.add('in'),1100);
    },600);
  });

  // 寄送卡片切換
  document.querySelectorAll('.ship-card input').forEach(r=>{
    r.addEventListener('change', ()=>{
      calculate();
      document.querySelectorAll('.ship-card').forEach(card=>{
        const input=card.querySelector('input');
        card.classList.toggle('selected', input.checked);
      });
    });
  });

  // 一行優惠：顯示 & 倒數動畫到 12/17 23:59:59
  setupInlinePromo();

  // 姓名 -> 電話 -> Email 自動跳
  const nameInput  = document.getElementById('customerName');
  const phoneInput = document.getElementById('customerPhone');
  const emailInput = document.getElementById('customerEmail');

  let jumpTimer;
  nameInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); phoneInput.focus(); }});
  nameInput.addEventListener('change', ()=>{ if(nameInput.value.trim().length){ phoneInput.focus(); }});
  nameInput.addEventListener('input', ()=>{
    clearTimeout(jumpTimer);
    jumpTimer = setTimeout(()=>{
      if(document.activeElement===nameInput && nameInput.value.trim().length>=2){
        phoneInput.focus();
      }
    }, 600);
  });

  phoneInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); emailInput.focus(); }});
  phoneInput.addEventListener('change', ()=>{ if(phoneInput.value.trim().length){ emailInput.focus(); }});
  phoneInput.addEventListener('input', ()=>{
    clearTimeout(jumpTimer);
    jumpTimer = setTimeout(()=>{
      if(document.activeElement===phoneInput && phoneInput.value.trim().length>=6){
        emailInput.focus();
      }
    }, 500);
  });
});

/* 一行優惠：從現在起 → 到 12/17 23:59:59 顯示；倒數數字動畫 */
function setupInlinePromo(){
  try{
    const wrap = document.getElementById('promoInline');
    const daysEl = document.getElementById('promoDays');
    if(!wrap || !daysEl) return;

    const now   = new Date();                  // 使用者當地時間
    const year  = now.getFullYear();
    const end   = new Date(year, 11, 17, 23, 59, 59); // 12/17 23:59:59

    if(now <= end){
      const msPerDay = 24*60*60*1000;
      const daysLeft = Math.max(1, Math.ceil((end - now) / msPerDay));

      animatePromoNumber(daysEl, daysLeft);
      wrap.hidden = false;

      // 跨日自動刷新倒數
      const msToMidnight = new Date(now.getFullYear(), now.getMonth(), now.getDate()+1, 0,0,0) - now + 50;
      setTimeout(()=>{ 
        const now2 = new Date();
        const d2 = Math.max(1, Math.ceil((end - now2)/(msPerDay)));
        animatePromoNumber(daysEl, d2);
      }, msToMidnight);
    }else{
      wrap.hidden = true; // 12/18 之後自動隱藏
    }
  }catch(e){}
}

/* 倒數數字動畫（與 total 的感覺一致） */
function animatePromoNumber(el, target){
  if(!el) return;
  let from = parseInt((el.textContent||'').replace(/[^\d]/g,''),10);
  if(isNaN(from)) from = 0;

  const duration = 900;
  const t0 = performance.now();
  const ease = t => 1 - Math.pow(1 - t, 3);

  function frame(now){
    const p = Math.min(1, (now - t0) / duration);
    const v = Math.max(1, Math.round(from + (target - from) * ease(p)));
    el.textContent = v + ' 天';
    if(p < 1){ requestAnimationFrame(frame); } 
    else { el.textContent = target + ' 天'; }
  }
  el.classList.remove('animate'); void el.offsetWidth; el.classList.add('animate');
  requestAnimationFrame(frame);
}

/* ===== Stepper（0–35、±1、含長按連續） ===== */
function buildQty(){
  const MIN=0, MAX=35;
  const select = document.getElementById('qty1');
  const minus  = document.getElementById('qtyMinus');
  const plus   = document.getElementById('qtyPlus');
  const input  = document.getElementById('qtyInput');

  function clamp(n){
    n = Number(n);
    if(Number.isNaN(n)) n = 0;
    return Math.min(MAX, Math.max(MIN, n|0));
  }

  function syncTo(val, trigger=true){
    const v = clamp(val);
    if(select.value !== String(v)) select.value = String(v);
    if(input.value  !== String(v)) input.value  = String(v);
    input.setAttribute('aria-valuenow', String(v));
    if(trigger) calculate();
  }

  // 點擊 ±1（抑制長按後多觸發的 click）
  function setupClick(btn, delta){
    btn.addEventListener('click', (e)=>{
      if(btn._holdTriggered){
        e.preventDefault();
        btn._holdTriggered = false;
        return;
      }
      syncTo(Number(select.value)+delta);
    });
  }
  setupClick(minus,-1);
  setupClick(plus, 1);

  // 長按連續
  function setupHold(btn, delta){
    let tDelay, tRepeat;
    const step=()=> syncTo(Number(select.value)+delta);

    const start = (e)=>{
      btn._holdTriggered=false;
      tDelay=setTimeout(()=>{
        step();
        btn._holdTriggered = true;
        tRepeat=setInterval(step, 70);
      }, 350);
      btn.setPointerCapture?.(e.pointerId);
    };
    const stop = ()=>{
      clearTimeout(tDelay);
      clearInterval(tRepeat);
    };
    btn.addEventListener('pointerdown', start);
    btn.addEventListener('pointerup', stop);
    btn.addEventListener('pointercancel', stop);
    btn.addEventListener('pointerleave', stop);
  }
  setupHold(minus,-1);
  setupHold(plus, 1);

  // 鍵盤 & 直接輸入
  input.addEventListener('keydown', (e)=>{
    const v = Number(select.value);
    if(['ArrowUp','ArrowRight'].includes(e.key)){ e.preventDefault(); syncTo(v+1); }
    else if(['ArrowDown','ArrowLeft'].includes(e.key)){ e.preventDefault(); syncTo(v-1); }
    else if(e.key==='Home'){ e.preventDefault(); syncTo(MIN); }
    else if(e.key==='End'){ e.preventDefault(); syncTo(MAX); }
    else if(e.key==='PageUp'){ e.preventDefault(); syncTo(v+5); }
    else if(e.key==='PageDown'){ e.preventDefault(); syncTo(v-5); }
  });
  input.addEventListener('input', ()=>{
    input.value = input.value.replace(/[^0-9]/g,'').slice(0,2);
    const v = input.value==='' ? 0 : clamp(input.value);
    syncTo(v, true);
  });
  input.addEventListener('blur', ()=>{
    syncTo(input.value==='' ? 0 : input.value, true);
  });

  syncTo(select.value||0, false);
}

/* ===== 計算金額（以 $299 為準） ===== */
let lastTotal=0;
function calculate(isInit){
  const qty1=parseInt(document.getElementById('qty1').value)||0;
  let ship=0;
  const method=document.querySelector('input[name="shipMethod"]:checked');
  if(method){ ship=(method.value==='711')?60:120; }
  const newTotal=qty1*299+ship;
  animateTotal(newTotal, !!isInit);
}
function animateTotal(target, isInit){
  const el=document.getElementById('total');
  if(isInit){ lastTotal=target; el.textContent='Total Amount: $'+target; el.classList.add('show'); return; }
  el.classList.remove('animate','glow'); void el.offsetWidth; el.classList.add('animate','glow');
  if(window.matchMedia('(prefers-reduced-motion: reduce)').matches){ lastTotal=target; el.textContent='Total Amount: $'+target; return; }
  const dur=900, t0=performance.now(), from=lastTotal, d=target-from, ease=t=>1-Math.pow(1-t,3);
  function frame(now){ const p=Math.min(1,(now-t0)/dur); const v=Math.round(from+d*ease(p));
    el.textContent='Total Amount: $'+v; if(p<1){ requestAnimationFrame(frame);} else { lastTotal=target; } }
  requestAnimationFrame(frame);
}

/* ===== 複製帳號／截圖／送表單 ===== */
function copyAccount(){
  const acct=document.getElementById('accountNumber').innerText;
  if(navigator.clipboard && window.isSecureContext){
    navigator.clipboard.writeText(acct).then(()=>{ showToast('匯款帳號已複製，完成匯款後請按下一步填寫寄送資訊。'); })
    .catch(()=>alert('匯款帳號已複製！'));
  }else{
    const ta=document.createElement('textarea'); ta.value=acct; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta);
    showToast('匯款帳號已複製，完成匯款後請按下一步填寫寄送資訊。');
  }
}
function screenshotOrder(){
  const target=document.getElementById('mainContent');
  if(typeof html2canvas==='undefined'){ alert('截圖功能庫尚未載入，請稍後再試或檢查網路連線。'); return; }
  html2canvas(target).then(canvas=>{
    const link=document.createElement('a');
    link.href=canvas.toDataURL('image/png');
    link.download='liu_mama_order.png';
    document.body.appendChild(link); link.click(); document.body.removeChild(link);
    showToast('截圖已下載！記得填寫表單喔。');
  }).catch(()=>alert('截圖失敗，請再試一次'));
}
function showToast(msg){
  const el=document.getElementById('toast');
  if(!el){ alert(msg); return; }
  el.textContent=msg; el.classList.add('show');
  clearTimeout(showToast._t);
  showToast._t=setTimeout(()=>el.classList.remove('show'),2200);
}
function setFieldError(el, id, msg){
  const hint=document.getElementById(id);
  if(msg){ el.classList.add('input-error'); el.setAttribute('aria-invalid','true'); hint.textContent=msg; hint.hidden=false; }
  else  { el.classList.remove('input-error'); el.setAttribute('aria-invalid','false'); hint.textContent=''; hint.hidden=true; }
}
function goToForm(){
  const name  = document.getElementById('customerName');
  const phone = document.getElementById('customerPhone');
  const email = document.getElementById('customerEmail');
  const qty   = parseInt(document.getElementById('qty1').value)||0;
  const method= document.querySelector('input[name="shipMethod"]:checked');

  let ok=true; setFieldError(name,'errName',''); setFieldError(phone,'errPhone',''); setFieldError(email,'errEmail','');

  if(!name.value.trim()){ setFieldError(name,'errName','請輸入訂購人姓名'); ok=false; }
  if(!phone.value.trim()){ setFieldError(phone,'errPhone','請輸入訂購人電話'); ok=false; }
  else if(!/^\d{10}$/.test(phone.value.trim())){ setFieldError(phone,'errPhone','電話需為 10 碼數字'); ok=false; }
  if(!email.value.trim()){ setFieldError(email,'errEmail','請輸入 Email'); ok=false; }
  else if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email.value.trim())){ setFieldError(email,'errEmail','Email 格式不正確'); ok=false; }

  if(qty<=0){ showToast('請選擇購買數量'); ok=false; }
  if(!method){ showToast('請選擇寄送方式'); ok=false; }
  if(!ok) return;

  const shipLabel = (method.value==='711') ? '711超商取貨' : '郵局宅配';
  const total = qty*299 + ((method.value==='711')?60:120);

  const base = 'https://docs.google.com/forms/d/e/1FAIpQLScXsrY_3yROVmqR3sa-WecBs4y8wKeZuPLSM0QNgy602xEWJA/viewform?usp=pp_url';
  const formUrl = base
    + `&entry.1152845848=${encodeURIComponent(name.value.trim())}`
    + `&entry.178268335=${encodeURIComponent(phone.value.trim())}`
    + `&entry.441082214=${encodeURIComponent(email.value.trim())}`
    + `&entry.1732058404=${qty}`
    + `&entry.509305715=${encodeURIComponent(shipLabel)}`
    + `&entry.1351577488=${encodeURIComponent(total)}`;
  window.open(formUrl,'_blank');
}

/* ===== Ripple（鍵盤也可觸發） ===== */
function triggerRipple(e){
  const btn=e.currentTarget, rect=btn.getBoundingClientRect();
  btn.style.setProperty('--rx',(e.clientX-rect.left)+'px');
  btn.style.setProperty('--ry',(e.clientY-rect.top)+'px');
  btn.classList.remove('rippling'); void btn.offsetWidth; btn.classList.add('rippling');
}
document.addEventListener('keydown',(e)=>{
  if(e.key==='Enter'){
    const btn=document.getElementById('startBtn');
    if(document.activeElement===btn){
      const r=btn.getBoundingClientRect();
      triggerRipple({currentTarget:btn, clientX:r.left+r.width/2, clientY:r.top+r.height/2});
    }
  }
});
</script>
</body>
</html>

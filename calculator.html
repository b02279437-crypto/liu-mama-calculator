<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>LIU MAMA Order</title>

<!-- 字體 -->
<link href="https://fonts.googleapis.com/css2?family=Amatic+SC:wght@700&family=Noto+Serif+TC:wght@500;600&display=swap" rel="stylesheet">
<!-- 截圖功能 -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>

<!-- 預載圖片 -->
<link rel="preload" as="image" href="https://raw.githubusercontent.com/b02279437-crypto/liu-mama-calculator/main/logo.png">
<link rel="preload" as="image" href="https://raw.githubusercontent.com/b02279437-crypto/liu-mama-calculator/main/LOGO2-removebg-preview.png">

<style>
:root{
  --milk:#E8D9C4; --navy:#1E4F7B; --bg:#f7f6f2; --gray-blue:#7f9bb3; --milk-solid:#e9e3d7;
  --ease:cubic-bezier(.22,.61,.36,1); --ease-soft:cubic-bezier(.2,.7,.2,1);
  --t-fast:.24s; --t-base:.6s; --t-slow:1.2s;
  --control-h:44px;
  --qty-btn-w:36px; --qty-disp-w:56px;
  --crayon-blue:#54677C; --crayon-blue-ink:#3C5168;
}

/* 全域樣式 */
html,body{
  margin:0; padding:0; height:100%;
  background-color:var(--bg); color:#2c3e50;
  font-family:'Noto Serif TC','Microsoft JhengHei',serif;
  text-align:center; overflow-x:hidden; scroll-behavior:smooth;
}

/* ===== 開場動畫 ===== */
#intro{
  position:fixed; inset:0; background-color:var(--bg);
  display:flex; flex-direction:column; align-items:center; justify-content:flex-start;
  padding-top:12vh; z-index:9999; opacity:1; transition:opacity var(--t-slow) var(--ease);
}
#intro.fade-out{opacity:0; pointer-events:none;}
#intro-logo{
  width:clamp(360px,92vw,700px);
  opacity:0; transform:scale(.99);
  transition:opacity calc(var(--t-slow)*1.1) var(--ease),transform calc(var(--t-slow)*1.3) var(--ease);
}
#intro-logo.show{opacity:1; transform:scale(1.04);}
#intro-logo.hide{opacity:0; transform:scale(1.04); transition:opacity var(--t-base) var(--ease);}
#intro-hero{
  width:clamp(260px,60vw,380px);
  opacity:0; transform:translateY(8px);
  transition:opacity var(--t-base) var(--ease), transform var(--t-base) var(--ease);
  margin:18px auto -72px; filter:drop-shadow(0 10px 14px rgba(0,0,0,0.15));
}
#intro-hero.show{opacity:1; transform:translateY(0);}
#intro-text{
  font-weight:500; color:#333; font-size:15px; line-height:1.9;
  opacity:0; white-space:pre-line; margin-top:-38px; letter-spacing:.5px;
  transition:opacity var(--t-base) var(--ease);
}
#intro-text.show{opacity:1;}
#startBtn{
  margin-top:16px; padding:12px 34px; font-size:26px;
  font-family:'Amatic SC',cursive; letter-spacing:2px; color:var(--navy);
  background:rgba(255,255,255,.62);
  border:1px solid rgba(255,255,255,.70); border-radius:999px;
  -webkit-backdrop-filter:blur(14px) saturate(1.06);
  backdrop-filter:blur(14px) saturate(1.06);
  box-shadow: inset 0 1px 0 rgba(255,255,255,.65), 0 10px 24px rgba(30,79,123,.14);
  cursor:pointer; position:relative; isolation:isolate;
  opacity:0; transform:translateY(10px);
  transition:opacity var(--t-base) var(--ease), transform var(--t-fast) var(--ease), filter .25s var(--ease);
}
#startBtn.show{opacity:1; transform:translateY(0);}
#startBtn:hover{transform:translateY(-2px);filter:brightness(1.03);}
#startBtn:active{transform:translateY(-1px);}
#startBtn::after{
  content:""; position:absolute; inset:auto; width:10px; height:10px; border-radius:50%;
  background:radial-gradient(circle,rgba(30,79,123,.18)0%,rgba(30,79,123,0)70%);
  transform:translate(-50%,-50%) scale(1); opacity:0; pointer-events:none;
}
#startBtn.rippling::after{left:var(--rx);top:var(--ry);animation:rippleInk .8s var(--ease-soft);}
@keyframes rippleInk{0%{opacity:.35;transform:translate(-50%,-50%)scale(1);}100%{opacity:0;transform:translate(-50%,-50%)scale(35);}}

/* ===== 主內容 ===== */
main{opacity:0;visibility:hidden;transition:opacity var(--t-slow) var(--ease);}
main.show{opacity:1;visibility:visible;}
h2{font-size:90px;font-weight:900;color:#1E4F7B;margin:28px 0 10px;}

/* ===== 表格與 Stepper ===== */
table{width:90%;max-width:500px;margin:15px auto;border-collapse:separate;border-spacing:0;background:#fff;
  border-radius:16px;overflow:hidden;box-shadow:0 2px 10px rgba(0,0,0,.08);font-size:15px;text-align:center;}
th,td{padding:10px;border-bottom:1px solid #e9eef2;vertical-align:middle;}
th{background-color:var(--gray-blue);color:#fff;}
.qty-stepper{display:inline-flex;align-items:center;height:var(--control-h);border:1px solid #ccc;border-radius:8px;background:#fff;}
.qty-btn{width:var(--qty-btn-w);height:100%;border:none;background:#f3f3f3;cursor:pointer;font-size:20px;}
.qty-input{width:var(--qty-disp-w);height:100%;border:none;border-left:1px solid #e6e6e6;border-right:1px solid #e6e6e6;text-align:center;font-size:16px;}

/* ===== 寄送方式卡片 ===== */
.ship-wrap{width:90%;max-width:500px;margin:8px auto 12px;display:flex;gap:12px;}
.ship-card{position:relative;flex:1;border-radius:14px;background:linear-gradient(180deg,rgba(255,255,255,.68),rgba(255,255,255,.5));
  backdrop-filter:blur(12px)saturate(1.04);border:1px solid rgba(255,255,255,.55);
  box-shadow:0 8px 22px rgba(20,40,60,.12);padding:14px 12px;cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:6px;}
.ship-card input{position:absolute;opacity:0;inset:0;pointer-events:none;}
.ship-card.selected{border-color:rgba(30,79,123,.55);box-shadow:0 12px 32px rgba(30,79,123,.18);}
.ship-title{font-size:15px;font-weight:600;}
.ship-price{font-size:15px;color:#4f5f70;}

/* ===== Total ===== */
.total{font-family:'Amatic SC',cursive;font-size:30px;font-weight:900;color:#1E4F7B;margin-top:16px;}
.total.animate{animation:totalUpdate .8s var(--ease);}
@keyframes totalUpdate{0%{transform:scale(1);}50%{transform:scale(1.04);}100%{transform:scale(1);}}

/* ===== 帳戶資訊 ===== */
.account-box{width:85%;max-width:350px;margin:25px auto 0;background:rgba(255,255,255,0.55);
  -webkit-backdrop-filter:blur(12px)brightness(1.05);backdrop-filter:blur(12px)brightness(1.05);
  border:1px solid rgba(255,255,255,0.4);color:#333;padding:16px;border-radius:16px;box-shadow:0 8px 24px rgba(0,0,0,0.07);}
.account-box h3{margin:8px 0;font-weight:600;font-size:15px;color:#44566C;}

/* ===== 按鈕樣式 ===== */
.btn{display:inline-flex;align-items:center;gap:8px;padding:12px 22px;border-radius:999px;border:1px solid transparent;
  font:600 15px 'Noto Serif TC','Microsoft JhengHei',serif;cursor:pointer;}
.btn-crayon{color:#fff;background:var(--crayon-blue);border:1px solid var(--crayon-blue-ink);}
.btn-sketch{color:var(--navy);background:transparent;border:2px solid var(--navy);}

/* ===== Toast ===== */
.toast{position:fixed;left:50%;bottom:22px;transform:translateX(-50%)translateY(20px);min-width:260px;
  background:rgba(255,255,255,.75);border:1px solid rgba(30,79,123,.18);border-radius:12px;padding:12px 16px;
  color:#1E4F7B;font-size:14px;font-weight:600;opacity:0;pointer-events:none;transition:opacity .5s var(--ease),transform .5s var(--ease);}
.toast.show{opacity:1;transform:translateX(-50%)translateY(0);}
</style>
</head>

<body>
<!-- ===== 開場 ===== -->
<div id="intro">
  <img id="intro-logo" src="https://raw.githubusercontent.com/b02279437-crypto/liu-mama-calculator/main/logo.png" alt="Logo">
  <img id="intro-hero" src="https://raw.githubusercontent.com/b02279437-crypto/liu-mama-calculator/main/LOGO2-removebg-preview.png" alt="Hero">
  <div id="intro-text">
2015年遠赴四川成都， 
學習正宗麻辣鍋底與紅油煉製。
手工慢炒堆疊香氣，濃郁而不膩。

劉嘛麻，一鍋來自初心的麻辣香氣，
陪你溫暖每一餐。
  </div>
  <button id="startBtn">Start Order</button>
</div>

<!-- ===== 主內容 ===== -->
<main id="mainContent">
  <h2><span class="english">LIU MAMA Order</span></h2>

  <section>
    <table id="productTable">
      <tr><th>品項</th><th>價格</th><th>數量</th></tr>
      <tr>
        <td>麻辣底料包<br><small>(2人份)</small></td>
        <td>$320</td>
        <td>
          <div class="qty-stepper">
            <button type="button" id="qtyMinus">−</button>
            <input id="qtyInput" type="text" value="0">
            <button type="button" id="qtyPlus">＋</button>
          </div>
          <select id="qty1" hidden></select>
        </td>
      </tr>
    </table>
  </section>

  <section>
    <div class="ship-wrap">
      <label class="ship-card"><input type="radio" name="ship" value="711"><div class="ship-title">711超商取貨</div><div class="ship-price">$60</div></label>
      <label class="ship-card"><input type="radio" name="ship" value="post"><div class="ship-title">郵局宅配</div><div class="ship-price">$120</div></label>
    </div>
    <div class="total" id="total">Total Amount: $0</div>
  </section>

  <section>
    <div class="account-box">
      <h3>請匯款至以下帳戶:</h3>
      <p>台新銀行 812　帳號：<span id="accountNumber">123456789</span> 陳慧珍</p>
      <button id="copyBtn" class="btn btn-crayon">複製匯款帳號</button>
    </div>

    <div style="display:flex;justify-content:center;gap:12px;flex-wrap:wrap;margin-top:32px;">
      <button id="screenshotBtn" class="btn btn-sketch">保存訂單截圖</button>
      <button id="formBtn" class="btn btn-crayon">下一步：填寫寄送資訊</button>
    </div>
    <p id="formReminder" style="font-size:14px;margin-top:16px;">煩請先匯款後,一定要按下一步填寫寄送資訊!</p>
  </section>
</main>

<div id="toast" class="toast"></div>

<script>
function imgReady(el){if(el.complete){if('decode'in el)return el.decode().catch(()=>{});return Promise.resolve();}
return new Promise(r=>{el.addEventListener('load',r,{once:true});el.addEventListener('error',r,{once:true});});}
async function startIntroSequence(){
  const logo=document.getElementById('intro-logo');
  const hero=document.getElementById('intro-hero');
  const text=document.getElementById('intro-text');
  const btn=document.getElementById('startBtn');
  const maxWait=new Promise(r=>setTimeout(r,4000));
  await Promise.race([Promise.all([imgReady(logo),imgReady(hero)]),maxWait]);
  requestAnimationFrame(()=>{
    logo.classList.add('show');
    setTimeout(()=>logo.classList.add('hide'),2000);
    setTimeout(()=>{logo.style.display='none';hero.classList.add('show');text.classList.add('show');},3200);
    setTimeout(()=>btn.classList.add('show'),4800);
  });
}

window.addEventListener('DOMContentLoaded',()=>{
  const select=document.getElementById('qty1');
  for(let i=0;i<=35;i++){const o=document.createElement('option');o.value=i;o.textContent=i;select.appendChild(o);}
  select.value="0";
  buildQty();
  calculate(true);
  startIntroSequence();

  const intro=document.getElementById('intro');
  const btn=document.getElementById('startBtn');
  const main=document.getElementById('mainContent');
  btn.addEventListener('click',e=>{
    triggerRipple(e);
    intro.classList.add('fade-out');
    setTimeout(()=>{intro.style.display='none';main.classList.add('show');},600);
  });

  document.querySelectorAll('.ship-card input').forEach(r=>{
    r.addEventListener('change',()=>{
      document.querySelectorAll('.ship-card').forEach(card=>{
        card.classList.toggle('selected',card.querySelector('input').checked);
      });
      calculate();
    });
  });

  document.getElementById('copyBtn').onclick=copyAccount;
  document.getElementById('screenshotBtn').onclick=screenshotOrder;
  document.getElementById('formBtn').onclick=goToForm;
});

/* ===== 修正版 Stepper ===== */
function buildQty(){
  const MIN=0,MAX=35;
  const select=document.getElementById('qty1');
  const minus=document.getElementById('qtyMinus');
  const plus=document.getElementById('qtyPlus');
  const input=document.getElementById('qtyInput');

  function clamp(n){n=parseInt(n,10);if(isNaN(n))n=0;return Math.min(MAX,Math.max(MIN,n));}
  function syncTo(val,trigger=true){
    const v=clamp(val);select.value=String(v);input.value=String(v);if(trigger)calculate();
  }

  minus.addEventListener('click',()=>syncTo(Number(select.value)-1));
  plus.addEventListener('click',()=>syncTo(Number(select.value)+1));

  function hold(btn,delta){
    let holdTimer,repeatTimer;
    const step=()=>syncTo(Number(select.value)+delta);
    const start=()=>{step();holdTimer=setTimeout(()=>repeatTimer=setInterval(step,70),500);};
    const stop=()=>{clearTimeout(holdTimer);clearInterval(repeatTimer);};
    btn.addEventListener('pointerdown',start);
    ['pointerup','pointercancel','pointerleave'].forEach(e=>btn.addEventListener(e,stop));
  }
  hold(minus,-1);hold(plus,1);

  input.addEventListener('input',()=>{input.value=input.value.replace(/[^0-9]/g,'').slice(0,2);syncTo(input.value===''?0:clamp(input.value));});
  input.addEventListener('blur',()=>syncTo(input.value===''?0:clamp(input.value)));
  syncTo(select.value||0,false);
}

/* Ripple */
function triggerRipple(e){
  const btn=e.currentTarget,rect=btn.getBoundingClientRect();
  btn.style.setProperty('--rx',(e.clientX-rect.left)+'px');
  btn.style.setProperty('--ry',(e.clientY-rect.top)+'px');
  btn.classList.remove('rippling');void btn.offsetWidth;btn.classList.add('rippling');
}

/* Toast */
function showToast(msg){
  const el=document.getElementById('toast');
  el.textContent=msg;el.classList.add('show');
  clearTimeout(showToast._t);
  showToast._t=setTimeout(()=>el.classList.remove('show'),2200);
}

/* 金額計算 */
let lastTotal=0;
function calculate(isInit){
  const qty=parseInt(document.getElementById('qty1').value)||0;
  let ship=0;
  const method=document.querySelector('input[name="ship"]:checked');
  if(method){ship=(method.value==='711')?60:120;}
  const total=qty*320+ship;
  animateTotal(total,!!isInit);
}
function animateTotal(target,isInit){
  const el=document.getElementById('total');
  if(isInit){lastTotal=target;el.textContent='Total Amount: $'+target;return;}
  el.classList.remove('animate');void el.offsetWidth;el.classList.add('animate');
  const dur=800,t0=performance.now(),from=lastTotal,d=target-from,ease=t=>1-Math.pow(1-t,3);
  function frame(now){const p=Math.min(1,(now-t0)/dur);const v=Math.round(from+d*ease(p));el.textContent='Total Amount: $'+v;if(p<1)requestAnimationFrame(frame);else lastTotal=target;}
  requestAnimationFrame(frame);
}

/* 匯款、截圖、表單 */
function copyAccount(){
  const acct=document.getElementById('accountNumber').innerText;
  navigator.clipboard.writeText(acct).then(()=>showToast('匯款帳號已複製')).catch(()=>alert('匯款帳號已複製'));
}
function screenshotOrder(){
  const target=document.getElementById('mainContent');
  html2canvas(target).then(canvas=>{
    const link=document.createElement('a');
    link.href=canvas.toDataURL('image/png');
    link.download='liu_mama_order.png';
    document.body.appendChild(link);link.click();document.body.removeChild(link);
    showToast('截圖已下載！記得填寫表單喔。');
  });
}
function goToForm(){
  const qty=parseInt(document.getElementById('qty1').value)||0;
  const method=document.querySelector('input[name="ship"]:checked');
  if(qty<=0)return showToast('請選擇購買數量');
  if(!method)return showToast('請選擇寄送方式');
  const total=qty*320+((method.value==='711')?60:120);
  const formUrl=`https://docs.google.com/forms/d/e/1FAIpQLScXsrY_3yROVmqR3sa-WecBs4y8wKeZuPLSM0QNgy602xEWJA/viewform?usp=pp_url`
  +`&entry.1732058404=${qty}`
  +`&entry.509305715=${encodeURIComponent(method.value==='711'?'711超商取貨':'郵局宅配')}`
  +`&entry.1351577488=${total}`;
  window.open(formUrl,'_blank');
}
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>LIU MAMA Order</title>

<link href="https://fonts.googleapis.com/css2?family=Amatic+SC:wght@700&family=Noto+Serif+TC:wght@500;600&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>

<style>
:root{
  --milk:#E8D9C4;
  --navy:#1E4F7B;
  --bg:#f7f6f2;
  --gray-blue:#7f9bb3;
  --milk-solid:#e9e3d7;
  --btn-blue:#2E73BE;
  --btn-blue-dark:#245C97;
}

/* ===== 全域 ===== */
html,body{
  margin:0; padding:0; height:100%;
  background-color:var(--bg); color:#2c3e50;
  font-family:'Noto Serif TC','Microsoft JhengHei',serif;
  text-align:center; overflow-x:hidden; scroll-behavior:smooth;
}

/* ===== 開場層 ===== */
#intro{
  position:fixed; inset:0; background-color:var(--bg);
  display:flex; flex-direction:column; align-items:center; justify-content:flex-start;
  padding-top:14vh; z-index:9999; opacity:1; transition:opacity .9s ease;
}
#intro.fade-out{opacity:0; pointer-events:none;}
#intro-logo{
  width:80vw; max-width:550px; opacity:0; transform:scale(.99);
  transition:opacity 1.2s ease, transform 1.6s ease;
}
#intro-logo.show{opacity:1; transform:scale(1.03);}
#intro-logo.hide{opacity:0; transform:scale(1.03); transition:opacity 1.1s ease;}
#intro-hero{
  width:clamp(260px,60vw,380px);
  opacity:0; transform:translateY(8px);
  transition:opacity 1.1s ease, transform 1.1s ease;
  margin:18px auto -72px;
  filter:drop-shadow(0 10px 14px rgba(0,0,0,.15));
}
#intro-hero.show{opacity:1; transform:translateY(0);}
#intro-text{
  font-weight:500; color:#333; font-size:15px; line-height:1.9;
  opacity:0; white-space:pre-line; margin-top:-38px; letter-spacing:.5px;
  transition:opacity 1.1s ease;
}
#intro-text.show{opacity:1;}

/* ===== 不規則藍色 Start 按鈕（含紙感＋散開） ===== */
#startBtn{
  margin-top:16px; padding:16px 54px; font-size:30px;
  font-family:'Amatic SC',cursive; letter-spacing:2px; color:#fff;
  border:none; cursor:pointer; position:relative; overflow:hidden; isolation:isolate;
  background:linear-gradient(180deg,#6DA2CF 0%,#4E86BC 55%,var(--btn-blue-dark) 100%);
  border-radius:42% 58% 48% 52% / 60% 38% 62% 40%;
  box-shadow:0 8px 18px rgba(36,92,151,.28), inset 0 1px 0 rgba(255,255,255,.45);
  opacity:0; transform:translateY(10px); transition:opacity .9s ease, transform .5s ease;
  will-change:transform;
}
#startBtn.show{opacity:1; transform:translateY(0);}
#startBtn:hover{transform:translateY(-2px);}
#startBtn:active{transform:translateY(0) scale(.98);}
#startBtn::before{
  content:""; position:absolute; inset:0; pointer-events:none; mix-blend-mode:overlay; opacity:.9;
  background:
    radial-gradient(120% 100% at 20% 0%, rgba(255,255,255,.35), transparent 55%),
    radial-gradient(140% 120% at 80% 120%, rgba(0,0,0,.22), transparent 60%),
    repeating-linear-gradient(45deg, rgba(255,255,255,.06) 0 2px, rgba(255,255,255,0) 2px 4px);
}
#startBtn::after{
  content:""; position:absolute; inset:0; pointer-events:none; opacity:.18; mix-blend-mode:multiply;
  background:
    radial-gradient(1px 1px at 6px 9px, rgba(0,0,0,.35) 50%, transparent 52%) repeat,
    radial-gradient(1px 1px at 13px 5px, rgba(0,0,0,.25) 50%, transparent 52%) repeat;
  background-size:14px 14px, 16px 16px;
}

/* 粒子 */
.particle{
  position:fixed; width:var(--sz); height:var(--sz); border-radius:50%;
  left:var(--x); top:var(--y); transform:translate(-50%,-50%);
  background: radial-gradient(circle at 30% 30%, #9fc3e2, #5f93c2 45%, #2e73be 90%);
  box-shadow:0 0 0.5px rgba(0,0,0,.25);
  pointer-events:none; z-index:10001; opacity:.95;
  animation:fly var(--dur) ease-out forwards;
}
@keyframes fly{
  to{ transform:translate(calc(-50% + var(--dx)), calc(-50% + var(--dy))) scale(.25); opacity:0; }
}

/* ===== 主內容 ===== */
main{opacity:0; visibility:hidden; transition:opacity 1s ease;}
main.show{opacity:1; visibility:visible;}
h2{
  font-size:90px; font-weight:900; color:var(--navy);
  margin:28px 0 10px 0; animation:titleFade 1.8s ease forwards;
}
@keyframes titleFade{
  0%{opacity:0; transform:translateY(12px) scale(.95);}
  50%{opacity:.7; transform:translateY(4px) scale(1.01);}
  100%{opacity:1; transform:translateY(0) scale(1);}
}
h2 .english{font-family:'Amatic SC',cursive; font-weight:900;}
.section-title{font-size:14px; color:#555; margin:10px 0 8px;}
.reveal{opacity:0; transform:translateY(34px); transition:all .9s;}
.reveal.in{opacity:1; transform:translateY(0);}

/* ===== 卡片與表格 ===== */
.input-container{max-width:500px; margin:0 auto 30px; text-align:left; background:#fff; padding:25px 28px; border-radius:16px; box-shadow:0 6px 22px rgba(0,0,0,.05);}
.input-group{display:flex; flex-direction:column; gap:5px; margin-bottom:18px;}
.input-group label{font-size:14px; color:#333;}
.input-group input{font-size:14px; padding:8px 10px; border:1px solid #ccc; border-radius:8px; background:#fafafa;}
.input-group input:focus{border-color:var(--navy); background:#fff; box-shadow:0 0 6px rgba(30,79,123,.25);}
.input-error{border-color:#e74c3c !important;}

table{
  width:90%; max-width:500px; margin:15px auto; border-collapse:separate; border-spacing:0;
  background:#fff; border-radius:16px; overflow:hidden; box-shadow:0 2px 10px rgba(0,0,0,.08);
  font-size:15px; table-layout:fixed; text-align:center;
}
th,td{padding:10px; border-bottom:1px solid #e9eef2; vertical-align:middle; overflow:visible; white-space:nowrap;}
th{background-color:var(--gray-blue); color:#fff; font-weight:500;}
.col-price{width:90px;} .col-action{width:100px;} .col-sub{width:110px;}
#productTable{ margin:15px auto 28px; }
#shippingTable{ margin:10px auto 18px; }

/* 下拉寬度 */
select{ width:70px; box-sizing:border-box; text-align:center; font-size:14px; padding:5px 6px; border-radius:6px; border:1px solid #ccc; background:#fff; }

/* ===== 一般款核取方塊：白底＋藍色勾勾 ===== */
.cb{
  appearance:none; -webkit-appearance:none; -moz-appearance:none;
  width:20px; height:20px; border-radius:6px; background:#fff;
  border:2px solid #5F93C2; display:inline-grid; place-content:center;
  transition:border-color .15s ease, box-shadow .15s ease, transform .1s ease;
}
.cb:active{ transform:scale(.96); }
.cb:focus-visible{ outline:2px solid rgba(46,115,190,.35); outline-offset:2px; }
.cb::after{
  content:""; width:10px; height:6px;
  border:3px solid #2E73BE; border-top:0; border-left:0;
  transform:rotate(45deg) scale(0); transform-origin:center;
  transition:transform .14s ease;
}
.cb:checked::after{ transform:rotate(45deg) scale(1); }

/* ===== Total（柔光） ===== */
.total{
  font-family:'Amatic SC',cursive;
  font-size:30px; font-weight:900; letter-spacing:2.5px; color:var(--navy);
  margin-top:25px; position:relative; display:inline-block;
  padding:6px 18px; opacity:0; transform:translateY(10px) scale(0.96);
  transition:opacity 1.2s ease, transform 1.2s ease;
  z-index:0; isolation:isolate;
}
.total.show{opacity:1; transform:translateY(0) scale(1);}
.total::before{
  content:""; position:absolute; left:0; top:50%; width:100%; height:60%;
  transform:translateY(-50%) rotate(-1.5deg) scale(1);
  background:linear-gradient(120deg, rgba(255,229,185,0.9) 0%, rgba(255,215,160,0.7) 100%);
  border-radius:12px; z-index:-1; filter:blur(1px) saturate(1.1); opacity:.7;
}
@keyframes totalUpdate{0%{transform:scale(1)}50%{transform:scale(1.07)}100%{transform:scale(1)}}
.total.animate{animation:totalUpdate .8s ease;}
@keyframes glowPulse{
  0%{opacity:.35; transform:translateY(-50%) rotate(-1.5deg) scale(1); filter:blur(1px) saturate(1.1) brightness(1);}
  45%{opacity:1; transform:translateY(-50%) rotate(-1.5deg) scale(1.06); filter:blur(2px) saturate(1.25) brightness(1.15);}
  100%{opacity:.6; transform:translateY(-50%) rotate(-1.5deg) scale(1); filter:blur(1px) saturate(1.1) brightness(1);}
}
.total.glow::before{animation:glowPulse .9s ease;}

/* ===== 匯款區與按鈕 ===== */
.account-box{
  width:85%; max-width:350px; margin:25px auto 0;
  background:rgba(255,255,255,0.5); backdrop-filter:blur(12px) brightness(1.05);
  border:1px solid rgba(255,255,255,0.4); color:#333; padding:16px; border-radius:16px; font-size:13px;
  box-shadow:0 8px 24px rgba(0,0,0,0.07);
}
.account-box h3{margin:8px 0; font-weight:600; font-size:15px; color:#44566C; letter-spacing:.5px;}
.copy-btn,#screenshotBtn,#formBtn{
  border:none; padding:12px 22px; border-radius:999px; font-size:16px; cursor:pointer; font-weight:500; transition:.25s; box-shadow:0 3px 10px rgba(0,0,0,.08);
}
.copy-btn,#screenshotBtn{background-color:var(--milk-solid); color:#1f2a33;}
.copy-btn:hover,#screenshotBtn:hover{background-color:#e4ddcf; transform:translateY(-2px);}
#formBtn{background-color:var(--navy); color:#fff; box-shadow:0 4px 14px rgba(30,79,123,.35);}
#formBtn:hover{background-color:#245c91; transform:translateY(-2px);}
#buttonContainer{display:flex; justify-content:center; gap:12px; flex-wrap:wrap; margin-top:32px;}
#formReminder{font-size:14px; color:#555; margin-top:16px; opacity:0; transform:translateY(14px); transition:all .8s;}
#formReminder.in{opacity:1; transform:translateY(0);}

/* ===== 手機 ===== */
@media (max-width:480px){
  h2{font-size:60px;}
  table{font-size:13.5px; width:96%;}
  .col-price{width:80px;} .col-action{width:100px;} .col-sub{width:96px;}
  .input-container{width:90%; padding:18px;}
  .account-box{font-size:12.5px; width:90%;}
  .copy-btn,#screenshotBtn,#formBtn{font-size:14px; padding:10px 18px;}
  #intro-hero{width:clamp(240px,68vw,360px); margin:14px auto -66px;}
  #intro-text{margin-top:-34px; line-height:1.9;}
  #startBtn{margin-top:12px;}
  #productTable{margin:14px auto 26px;}
  #shippingTable{margin:10px auto 18px;}
  #buttonContainer{margin-top:36px;}
}
</style>
</head>

<body>
<!-- ===== 開場動畫 ===== -->
<div id="intro">
  <img id="intro-logo" src="https://github.com/b02279437-crypto/liu-mama-calculator/blob/main/logo.png?raw=true" alt="Logo">
  <img id="intro-hero" src="https://github.com/b02279437-crypto/liu-mama-calculator/blob/main/LOGO2-removebg-preview.png?raw=true" alt="Liu Mama Secondary Logo">

  <div id="intro-text">
2015年遠赴四川成都， 
學習正宗麻辣鍋底與紅油煉製。
手工慢炒堆疊香氣，濃郁而不膩。

劉嘛麻，一鍋來自初心的麻辣香氣，
陪你溫暖每一餐。
  </div>
  <button id="startBtn">Start Order</button>
</div>

<!-- ===== 主內容 ===== -->
<main id="mainContent">
  <h2 id="pageTitle"><span class="english">LIU MAMA Order</span></h2>

  <section class="reveal left">
    <p class="section-title">請填寫訂購人資訊</p>
    <div class="input-container">
      <div class="input-group">
        <label for="customerName">訂購人姓名</label>
        <input type="text" id="customerName" placeholder="請輸入姓名">
      </div>
      <div class="input-group">
        <label for="customerPhone">訂購人電話</label>
        <input type="text" id="customerPhone" placeholder="請輸入電話" oninput="this.value=this.value.replace(/[^0-9]/g,'')">
      </div>
    </div>
  </section>

  <section class="reveal right">
    <p class="section-title">請選擇購買數量與寄送方式，系統將自動計算金額</p>
    <table id="productTable">
      <colgroup>
        <col><col class="col-price"><col class="col-action"><col class="col-sub">
      </colgroup>
      <tr><th>品項</th><th>價格</th><th>數量</th><th>小計</th></tr>
      <tr>
        <td>麻辣底料包<br><small>(2人份)</small></td>
        <td>$320</td>
        <td><select id="qty1" onchange="calculate()"></select></td>
        <td id="sub1">$0</td>
      </tr>
    </table>
  </section>

  <section class="reveal left">
    <table id="shippingTable">
      <colgroup>
        <col><col class="col-price"><col class="col-action"><col class="col-sub">
      </colgroup>
      <tr><th>寄送方式</th><th>價格</th><th>勾選</th><th>小計</th></tr>
      <tr>
        <td>711超商取貨</td><td>$60</td>
        <td><input type="checkbox" class="cb" id="ship711" onchange="selectShip('711')"></td>
        <td id="sub711">$0</td>
      </tr>
      <tr>
        <td>郵局宅配</td><td>$120</td>
        <td><input type="checkbox" class="cb" id="shipPost" onchange="selectShip('post')"></td>
        <td id="subPost">$0</td>
      </tr>
    </table>
    <div class="total" id="total">Total Amount: $0</div>
  </section>

  <section class="reveal right">
    <div class="account-box">
      <h3>請匯款至以下帳戶:</h3>
      <p>台新銀行 812　帳號：<span id="accountNumber">123456789</span> 陳慧珍</p>
      <button class="copy-btn" onclick="copyAccount()">複製匯款帳號</button>
    </div>

    <div id="buttonContainer">
      <button id="screenshotBtn" onclick="screenshotOrder()">截圖訂單</button>
      <button id="formBtn" onclick="goToForm()">下一步,填寫寄送資訊</button>
    </div>
    <p id="formReminder">煩請先匯款後,一定要按下一步填寫寄送資訊!</p>
  </section>
</main>

<script>
// ===== 啟動與動畫 =====
window.addEventListener('DOMContentLoaded',()=>{
  // 數量 0–35
  const select=document.getElementById('qty1');
  for(let i=0;i<=35;i++){ const o=document.createElement('option'); o.value=i; o.textContent=i; select.appendChild(o); }
  select.value="0"; calculate();

  // 開場動畫
  const intro=document.getElementById('intro');
  const logo=document.getElementById('intro-logo');
  const hero=document.getElementById('intro-hero');
  const text=document.getElementById('intro-text');
  const btn=document.getElementById('startBtn');
  const main=document.getElementById('mainContent');

  setTimeout(()=>logo.classList.add('show'),300);
  setTimeout(()=>logo.classList.add('hide'),2500);
  setTimeout(()=>{ logo.style.display='none'; hero.classList.add('show'); text.classList.add('show'); },3900);
  setTimeout(()=>btn.classList.add('show'),5700);

  // 按下產生粒子 → 進入主畫面
  btn.addEventListener('click',(e)=>{
    burst(e);                   // 粒子散開
    setTimeout(()=>{
      intro.classList.add('fade-out');
      setTimeout(()=>{
        intro.style.display='none';
        main.classList.add('show');
        document.querySelectorAll('.reveal').forEach((el,i)=>setTimeout(()=>el.classList.add('in'), i*200));
        setTimeout(()=>document.querySelector('.total').classList.add('show'),1300);
        setTimeout(()=>document.getElementById('formReminder').classList.add('in'),1400);
      },600);
    },260); // 讓粒子先飛一下更有感
  });
});

// 粒子散開效果（從按鈕中心）
function burst(evt){
  const btn = evt.currentTarget;
  const rect = btn.getBoundingClientRect();
  const cx = rect.left + rect.width/2;
  const cy = rect.top  + rect.height/2;
  const count = 34;
  for(let i=0;i<count;i++){
    const p=document.createElement('span');
    p.className='particle';
    const angle = Math.random()*Math.PI*2;
    const dist  = 60 + Math.random()*120;
    const dx = Math.cos(angle)*dist;
    const dy = Math.sin(angle)*dist;
    const sz = 8 + Math.random()*10;
    const dur = 450 + Math.random()*420;
    p.style.setProperty('--x', cx+'px');
    p.style.setProperty('--y', cy+'px');
    p.style.setProperty('--dx', dx+'px');
    p.style.setProperty('--dy', dy+'px');
    p.style.setProperty('--sz', sz+'px');
    p.style.setProperty('--dur', dur+'ms');
    document.body.appendChild(p);
    p.addEventListener('animationend', ()=>p.remove());
  }
}

// ===== 計算金額（含柔光觸發） =====
function calculate(){
  const qty = parseInt(document.getElementById('qty1').value)||0;
  document.getElementById('sub1').innerText = '$'+(qty*320);

  let ship=0;
  const c711 = document.getElementById('ship711').checked;
  const cPost= document.getElementById('shipPost').checked;
  if(c711) ship=60;
  if(cPost) ship=120;

  document.getElementById('sub711').innerText = c711?'$60':'$0';
  document.getElementById('subPost').innerText = cPost?'$120':'$0';

  const totalText = 'Total Amount: $'+(qty*320+ship);
  const totalEl   = document.getElementById('total');
  totalEl.innerText = totalText;
  totalEl.classList.add('show');
  totalEl.classList.remove('animate','glow'); void totalEl.offsetWidth; totalEl.classList.add('animate','glow');
}

// 運送互斥
function selectShip(type){
  if(type==='711') document.getElementById('shipPost').checked=false;
  if(type==='post') document.getElementById('ship711').checked=false;
  calculate();
}

// 複製匯款帳號
function copyAccount(){
  const acct=document.getElementById('accountNumber').innerText;
  if(navigator.clipboard && window.isSecureContext){
    navigator.clipboard.writeText(acct).then(()=>alert('匯款帳號已複製！記得匯款後再按下一步填寫寄送資訊！'));
  }else{
    const ta=document.createElement('textarea');
    ta.value=acct; document.body.appendChild(ta); ta.select();
    document.execCommand('copy'); document.body.removeChild(ta);
    alert('匯款帳號已複製！記得匯款後再按下一步填寫寄送資訊！');
  }
}

// 截圖訂單
function screenshotOrder(){
  const target=document.getElementById('mainContent');
  if(typeof html2canvas==='undefined'){
    alert('截圖功能庫尚未載入，請稍後再試或檢查網路連線。');
    return;
  }
  html2canvas(target).then(canvas=>{
    const link=document.createElement('a');
    link.href=canvas.toDataURL('image/png');
    link.download='liu_mama_order.png';
    document.body.appendChild(link); link.click(); document.body.removeChild(link);
    alert('截圖已下載！記得填寫表單喔！');
  });
}

// 前往 Google 表單（帶參數）
function goToForm(){
  const name=document.getElementById('customerName').value.trim();
  const phone=document.getElementById('customerPhone').value.trim();
  const qty=parseInt(document.getElementById('qty1').value)||0;
  const ship711=document.getElementById('ship711').checked;
  const shipPost=document.getElementById('shipPost').checked;

  document.getElementById('customerName').classList.remove('input-error');
  document.getElementById('customerPhone').classList.remove('input-error');

  let err='';
  if(!name){ err+='請輸入訂購人姓名！\n'; document.getElementById('customerName').classList.add('input-error'); }
  if(!phone){ err+='請輸入訂購人電話！\n'; document.getElementById('customerPhone').classList.add('input-error'); }
  else if(!/^\d{10}$/.test(phone)){ err+='訂購人電話必須為10碼數字！\n'; document.getElementById('customerPhone').classList.add('input-error'); }
  if(qty<=0) err+='請選擇購買數量！\n';
  if(!ship711 && !shipPost) err+='請選擇寄送方式！';

  if(err){ alert('訂單填寫不完整:\n'+err); return; }

  const ship=ship711?'711超商取貨':'郵局宅配';
  const total=qty*320+(ship711?60:120);

  const formUrl=`https://docs.google.com/forms/d/e/1FAIpQLScXsrY_3yROVmqR3sa-WecBs4y8wKeZuPLSM0QNgy602xEWJA/viewform?usp=pp_url`
    +`&entry.1152845848=${encodeURIComponent(name)}`
    +`&entry.178268335=${encodeURIComponent(phone)}`
    +`&entry.1732058404=${qty}`
    +`&entry.509305715=${encodeURIComponent(ship)}`
    +`&entry.1351577488=${total}`;
  window.open(formUrl,'_blank');
}
</script>
</body>
</html>

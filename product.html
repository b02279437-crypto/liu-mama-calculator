<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<!-- 關閉手機自動把數字變電話（反藍） -->
<meta name="format-detection" content="telephone=no" />
<title>LIU MAMA Order</title>

<!-- 字體 -->
<link href="https://fonts.googleapis.com/css2?family=Amatic+SC:wght@700&family=Noto+Serif+TC:wght@500;600&display=swap" rel="stylesheet">
<!-- 截圖功能 -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>

<!-- 預載圖片 -->
<link rel="preload" as="image" href="https://raw.githubusercontent.com/b02279437-crypto/liu-mama-calculator/main/logo.png">
<link rel="preload" as="image" href="https://raw.githubusercontent.com/b02279437-crypto/liu-mama-calculator/main/LOGO2-removebg-preview.png">
<link rel="preload" as="image" href="https://raw.githubusercontent.com/b02279437-crypto/liu-mama-calculator/main/product-2">

<style>
:root{
  --milk:#E8D9C4;
  --navy:#2B3E53;
  --bg:#f7f6f2;
  --gray-blue:#7f9bb3;
  --milk-solid:#e9e3d7;
  --paper:#e4dccf;
  --ink:#2f3438;

  --line-blue:#aab5c4;

  --ease:cubic-bezier(.22,.61,.36,1);
  --ease-soft:cubic-bezier(.2,.7,.2,1);
  --t-fast:.24s;
  --t-base:.6s;
  --t-slow:1.2s;

  --control-h:44px;
  --qty-btn-w:36px;
  --qty-disp-w:56px;

  --crayon-blue:#54677C;
  --crayon-blue-ink:#3C5168;

  --promo-text:#2B3E53;
  --promo-red:#A6413C;

  --item-text:#2c3e50;
  --item-size:15px;
}

/* 手機若還是硬包 tel 連結，顏色也維持一般文字 */
a[href^="tel"]{
  color:inherit !important;
  text-decoration:none !important;
}

html{-webkit-text-size-adjust:100%;}
*{
  -webkit-tap-highlight-color: transparent;
  box-sizing:border-box;
}
button{ touch-action: manipulation; }

/* ===== 全域 ===== */
html,body{
  margin:0;
  padding:0;
  height:100%;
  background-color:var(--bg);
  color:#2c3e50;
  font-family:'Noto Serif TC','Microsoft JhengHei',serif;
  text-align:center;
  overflow-x:hidden;
  scroll-behavior:smooth;
}
table, .ship-card, .btn, .account-box, .promo-inline, input, label, small, p, div, span {
  font-family:inherit;
}
table td,table th,.total,#qty1,#formReminder,.ship-price{
  font-variant-numeric:tabular-nums lining-nums;
  font-feature-settings:"tnum" 1,"lnum" 1;
  letter-spacing:.02em;
}
::placeholder{
  color:rgba(120,120,120,.7);
}

/* 主要內容容器 */
.page-inner{
  max-width:720px;
  margin:0 auto 56px;
  padding:0 16px 40px;
}

/* ===== 開場動畫 ===== */
#intro{
  position:fixed;
  inset:0;
  background-color:var(--bg);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:flex-start;
  padding-top:12vh;
  z-index:9999;
  opacity:1;
  transition:opacity var(--t-slow) var(--ease);
}
#intro.fade-out{opacity:0; pointer-events:none;}

/* Stage 1：Logo */
#intro-logo{
  width:clamp(360px, 92vw, 700px);
  opacity:0;
  transform:scale(.99);
  transition:
    opacity calc(var(--t-slow)*1.1) var(--ease),
    transform calc(var(--t-slow)*1.3) var(--ease);
}
#intro-logo.show{opacity:1; transform:scale(1.02);}
#intro-logo.hide{
  opacity:0;
  transform:scale(1.02);
  transition:opacity var(--t-base) var(--ease);
}

/* Stage 2：原本的文字頁（LOGO2 + 故事文字） */
#intro-hero{
  width:clamp(260px,60vw,380px);
  opacity:0;
  transform:translateY(8px);
  transition:
    opacity var(--t-base) var(--ease),
    transform var(--t-base) var(--ease);
  margin:18px auto -72px;
  filter:drop-shadow(0 10px 14px rgba(0,0,0,0.12));
}
#intro-hero.show{
  opacity:1;
  transform:translateY(0);
}
#intro-text{
  font-weight:500;
  color:#333;
  font-size:15px;
  line-height:1.9;
  opacity:0;
  white-space:pre-line;
  margin-top:-38px;
  letter-spacing:.5px;
  transition:opacity var(--t-base) var(--ease);
}
#intro-text.show{opacity:1;}

/* Stage 3：Hero 產品照面板（product-2 + 按鈕） */
#intro-hero-panel{
  position:absolute;
  inset:0;
  padding:10vh 16px 8vh;
  display:flex;
  align-items:center;
  justify-content:center;
  opacity:0;
  pointer-events:none;
  transform:translateY(10px) scale(.98);
  transition:
    opacity var(--t-slow) var(--ease),
    transform var(--t-slow) var(--ease);
}
#intro-hero-panel.show{
  opacity:1;
  pointer-events:auto;
  transform:translateY(0) scale(1);
}
.hero-frame{
  position:relative;
  width:min(880px, 100%);
  border-radius:20px;
  overflow:hidden;
  box-shadow:0 18px 40px rgba(0,0,0,.22);
  background:#d9cdbb;
}
.hero-image{
  width:100%;
  display:block;
  min-height:220px;
  object-fit:cover;
}
.hero-overlay{
  position:absolute;
  inset:0;
  padding:clamp(18px,5vw,32px);
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:flex-start;
  text-align:left;
  background:
    linear-gradient(90deg, rgba(14,23,34,.68), rgba(14,23,34,.35), rgba(14,23,34,.08));
  color:#f9f7f3;
}
.hero-eyebrow{
  font-size:11px;
  letter-spacing:.28em;
  text-transform:uppercase;
  margin-bottom:10px;
  opacity:.85;
}
.hero-title{
  font-size:26px;
  letter-spacing:.22em;
  margin-bottom:8px;
}
.hero-sub{
  font-size:13px;
  letter-spacing:.14em;
  max-width:360px;
  margin-bottom:18px;
  opacity:.9;
}
.hero-actions{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
}

/* 開場按鈕（現在只出現在 Hero 產品頁） */
#startBtn,
#storyBtn{
  margin-top:0;
  padding:8px 20px 9px;
  display:inline-flex;
  flex-direction:row;
  align-items:center;
  justify-content:center;
  gap:6px;

  font-family:'Noto Serif TC','Microsoft JhengHei',serif;
  color:var(--navy);

  background:rgba(255,255,255,.85);
  border-radius:999px;
  border:none;

  -webkit-backdrop-filter:blur(16px) saturate(1.08);
  backdrop-filter:blur(16px) saturate(1.08);
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.85),
    0 9px 20px rgba(30,79,123,.18);

  cursor:pointer;
  position:relative;
  isolation:isolate;
  opacity:0;
  transform:translateY(10px);
  transition:
    opacity var(--t-base) var(--ease),
    transform var(--t-fast) var(--ease),
    box-shadow .25s var(--ease),
    filter .25s var(--ease);
}
#storyBtn{
  background:transparent;
  color:#f1ebe0;
  border:1px solid rgba(240,233,221,.8);
}
#startBtn .btn-main-en,
#storyBtn .btn-main-en{
  font-family:'Amatic SC',cursive;
  font-size:17px;
  letter-spacing:.18em;
}
#startBtn .btn-sub-zh,
#storyBtn .btn-sub-zh{
  font-size:12px;
  letter-spacing:.18em;
  text-indent:.18em;
  opacity:.9;
  display:flex;
  align-items:center;
  gap:4px;
}
#startBtn .btn-sub-zh::after,
#storyBtn .btn-sub-zh::after{
  content:"›";
  font-size:13px;
  transform:translateY(0.5px);
}
#startBtn.show,
#storyBtn.show{
  opacity:1;
  transform:translateY(0);
}
#startBtn:hover,
#storyBtn:hover{
  transform:translateY(-1px);
  filter:brightness(1.03);
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.95),
    0 11px 24px rgba(25,60,104,.22);
}
#startBtn:active,
#storyBtn:active{
  transform:translateY(0);
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.9),
    0 6px 14px rgba(25,60,104,.18);
}
#startBtn::after,
#storyBtn::after{
  content:"";
  position:absolute;
  inset:auto;
  width:10px;
  height:10px;
  border-radius:50%;
  background:radial-gradient(circle, rgba(255,255,255,.45) 0%, rgba(255,255,255,0) 70%);
  transform:translate(-50%,-50%) scale(1);
  opacity:0;
}
#startBtn.rippling::after,
#storyBtn.rippling::after{
  left:var(--rx);
  top:var(--ry);
  animation:rippleInk .8s var(--ease-soft);
}
@keyframes rippleInk{
  0%{opacity:.45; transform:translate(-50%,-50%) scale(1);}
  100%{opacity:0; transform:translate(-50%,-50%) scale(32);}
}

/* ===== 主內容 ===== */
main{
  opacity:0;
  visibility:hidden;
  transition:opacity var(--t-slow) var(--ease);
}
main.show{opacity:1; visibility:visible;}

/* 標題 */
h2{
  font-size:90px;
  font-weight:900;
  color:var(--navy);
  margin:28px 0 8px 0;
  opacity:0;
  transform:translateY(12px);
  letter-spacing:.04em;
}
h2 .english{
  font-family:'Amatic SC',cursive;
  font-weight:900;
  white-space:nowrap;
}
h2.title-in{
  animation:titleFloat 1.05s var(--ease) forwards;
}
@keyframes titleFloat{
  0%{
    opacity:0;
    transform:translateY(16px) scale(.97);
  }
  55%{
    opacity:1;
    transform:translateY(-2px) scale(1.02);
  }
  100%{
    opacity:1;
    transform:translateY(0) scale(1);
  }
}

/* 標語＋優惠 */
.brand-block{
  margin:4px 0 18px;
}
.brand-tagline{
  margin:6px 0 6px;
  font-size:14px;
  color:#3f4f61;
  letter-spacing:.38em;
  font-weight:500;
}
.promo-inline{
  width:min(640px, 100%);
  margin:0 auto 4px;
  font-size:12.5px;
  line-height:1.7;
  color:var(--promo-text);
  letter-spacing:.16em;
}
.promo-inline .price-red{
  color:var(--promo-red);
  font-weight:700;
  margin:0 2px;
}
.promo-mark{
  font-size:11px;
  opacity:.7;
  margin-right:4px;
}
.promo-sep{
  margin:0 4px;
  opacity:.5;
}
.promo-days{
  font-weight:800;
  display:inline-block;
  transform-origin:50% 60%;
}
.promo-days.animate{ animation: promoBounce .85s var(--ease); }
@keyframes promoBounce{
  0%{transform:scale(1);}
  45%{transform:scale(1.08);}
  100%{transform:scale(1);}
}

/* 區塊小標 */
.section-title{
  font-size:14px;
  color:#555;
  margin:26px 0 10px;
  display:inline-flex;
  align-items:center;
  gap:10px;
  position:relative;
  letter-spacing:.16em;
}
.section-title::before,
.section-title::after{
  content:"";
  flex:1;
  height:1px;
  background:linear-gradient(to right, rgba(46,67,94,0.2), transparent);
}
.section-title::before{max-width:64px;}
.section-title::after{
  max-width:120px;
  background:linear-gradient(to left, rgba(46,67,94,0.18), transparent);
}

/* scroll reveal */
.reveal{
  opacity:0;
  transform:translateY(28px);
  transition:
    opacity .9s var(--ease),
    transform .9s var(--ease);
}
.reveal.in{
  opacity:1;
  transform:translateY(0);
}

/* ===== 訂購資訊卡片 ===== */
.input-container{
  max-width:520px;
  margin:0 auto 30px;
  text-align:left;

  background:rgba(255,255,255,0.88);
  padding:24px 24px 22px;
  border-radius:18px;

  border:none;
  box-shadow:0 14px 32px rgba(0,0,0,0.03);
  -webkit-backdrop-filter:blur(10px);
  backdrop-filter:blur(10px);
}
.input-group{
  display:flex;
  flex-direction:column;
  gap:5px;
  margin-bottom:18px;
}
.input-group label{
  font-size:13px;
  color:#444;
  letter-spacing:.08em;
}
.input-group input{
  font-size:16px;
  height:var(--control-h);
  padding:0 12px;
  border:1px solid #c5cfdd;
  border-radius:8px;
  background:#ffffff;
  transition:
    border-color var(--t-fast) var(--ease),
    box-shadow var(--t-fast) var(--ease),
    background-color var(--t-fast) var(--ease);
}
.input-group input:focus{
  border-color:#7b8a9b;
  background:#ffffff;
  box-shadow:0 0 0 2px rgba(123,138,155,.2);
}
.input-error{
  border-color:#e74c3c !important;
  background:#fff5f4;
}
.error-hint{
  font-size:12px;
  color:#c0392b;
  margin-top:2px;
}

/* ===== 商品表格 ===== */
table{
  width:90%;
  max-width:520px;
  margin:15px auto 10px;
  border-collapse:separate;
  border-spacing:0;
  background:#fff;
  border-radius:16px;
  overflow:hidden;
  box-shadow:0 2px 10px rgba(0,0,0,.08);
  font-size:15px;
  table-layout:fixed;
  text-align:center;
}
th,td{
  padding:10px;
  border-bottom:1px solid #e9eef2;
  vertical-align:middle;
  white-space:nowrap;
}
th{
  background-color:var(--gray-blue);
  color:#fff;
  font-weight:500;
}

/* 三欄比例：品項 46%、價格 20%、數量 34% */
.col-item{  width:46%; }
.col-price{ width:20%; }
.col-action{ width:34%; }

#productTable td:nth-child(3),
#productTable th:nth-child(3){
  padding-left:6px;
  padding-right:6px;
}

/* 價格上下排（置中） */
.price-cell{
  display:flex;
  flex-direction:column;
  align-items:center;
  line-height:1.15;
}
.price-old{
  color:#7b8086;
  text-decoration:line-through;
  text-decoration-thickness:1.4px;
}
.price-new{
  margin-top:3px;
  font-size:13px;
  font-weight:700;
  color:var(--promo-red);
}

/* 隱藏原生 select */
#qty1[hidden]{ display:none !important; }

/* ===== Stepper ===== */
.qty-stepper{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  height:var(--control-h);
  border:1px solid var(--line-blue);
  border-radius:8px;
  background:#fff;
  width:calc(var(--qty-btn-w)*2 + var(--qty-disp-w) + 2px);
  max-width:100%;
}
.qty-btn{
  width:var(--qty-btn-w);
  height:100%;
  border:none;
  background:#f1f4f8;
  cursor:pointer;
  font-size:20px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  transition:
    background-color var(--t-fast) var(--ease),
    transform var(--t-fast) var(--ease);
  user-select:none;
}
.qty-btn:hover{ background:#e6edf6; }
.qty-btn:active{ transform:translateY(0); }
.qty-input{
  width:var(--qty-disp-w);
  height:100%;
  border:none;
  border-left:1px solid #d0d8e4;
  border-right:1px solid #d0d8e4;
  text-align:center;
  font-size:16px;
  background:#fff;
}
.qty-stepper:focus-within{
  box-shadow:0 0 0 3px rgba(123,138,155,.18);
  border-color:#9bb0c5;
}
.qty-btn:focus-visible,
.qty-input:focus-visible{
  outline:2px solid rgba(30,79,123,.55);
  outline-offset:2px;
}

/* ===== 寄送方式 ===== */
.ship-wrap{
  width:90%;
  max-width:520px;
  margin:10px auto 6px;
  display:flex;
  gap:12px;
  flex-wrap:wrap;
  justify-content:center;
}
.ship-card{
  --glow: rgba(30,79,123,.14);
  position:relative;
  flex:1 1 160px;
  max-width:190px;
  border-radius:14px;
  background:linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.72));
  -webkit-backdrop-filter:blur(10px) saturate(1.02);
  backdrop-filter:blur(10px) saturate(1.02);
  border:1px solid rgba(154,169,191,.88);
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.9),
    0 8px 22px rgba(40,50,70,.09);
  padding:12px 10px 10px;
  cursor:pointer;
  user-select:none;
  transition:
    transform var(--t-fast) var(--ease),
    box-shadow var(--t-base) var(--ease),
    border-color var(--t-fast) var(--ease),
    filter var(--t-fast) var(--ease);
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:4px;
  text-align:center;
}
.ship-card:hover{
  transform:translateY(-1px);
  filter:brightness(1.02);
}
.ship-card:active{ transform:translateY(0); }
.ship-card::after{
  content:"";
  position:absolute;
  inset:0;
  pointer-events:none;
  border-radius:inherit;
  background:
    radial-gradient(120% 70% at 50% -20%, rgba(255,255,255,.7), transparent 55%),
    radial-gradient(120% 90% at 50% 120%, var(--glow), transparent 60%);
  opacity:.16;
  transition:opacity var(--t-fast) var(--ease);
}
.ship-card input{
  position:absolute;
  opacity:0;
  inset:0;
  pointer-events:none;
}
.ship-title{
  font-size:var(--item-size);
  color:var(--item-text);
  font-weight:400;
  line-height:1.4;
  letter-spacing:.16em;
}
.ship-price{
  font-size:14px;
  line-height:1.35;
  letter-spacing:.08em;
  color:#4f5f70;
}

/* 選取狀態 */
.ship-card:has(input:checked),
.ship-card.selected{
  border-color:rgba(90,112,142,.9);
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.98),
    0 12px 30px rgba(40,60,90,.2),
    0 0 0 5px rgba(90,112,142,.16);
  filter:brightness(1.05);
}
.ship-card:has(input:checked)::after{ opacity:.26; }

/* 自取說明 */
.pickup-note{
  font-size:12px;
  color:#6a7a8a;
  letter-spacing:.08em;
  margin-top:4px;
  opacity:0;
  transform:translateY(6px);
  transition:opacity .5s var(--ease), transform .5s var(--ease);
}
.pickup-note.show{
  opacity:1;
  transform:translateY(0);
}

/* ===== Total ===== */
.total{
  font-family:'Amatic SC', cursive;
  font-size:30px;
  font-weight:900;
  letter-spacing:2.5px;
  color:var(--navy);
  margin-top:16px;
  position:relative;
  display:inline-block;
  padding:6px 18px;
  opacity:0;
  transform:translateY(10px) scale(.96);
  transition:
    opacity var(--t-slow) var(--ease),
    transform var(--t-slow) var(--ease);
  z-index:0;
}
.total.show{
  opacity:1;
  transform:translateY(0) scale(1);
}
.total::before{
  content:"";
  position:absolute;
  left:0;
  top:50%;
  width:100%;
  height:64%;
  transform:translateY(-50%) rotate(-1.2deg) scale(1);
  background:linear-gradient(120deg, rgba(255,229,185,.65) 0%, rgba(255,215,160,.5) 100%);
  border-radius:12px;
  z-index:-1;
  filter:blur(1px) saturate(1.05);
  opacity:.55;
  mix-blend-mode:soft-light;
}
@keyframes totalUpdate{
  0%{transform:scale(1);}
  50%{transform:scale(1.04);}
  100%{transform:scale(1);}
}
.total.animate{
  animation: totalUpdate .8s var(--ease);
}
@keyframes glowPulse{
  0%{
    opacity:.4;
    transform:translateY(-50%) rotate(-1.2deg) scale(1);
    filter:blur(1px) saturate(1.05) brightness(1);
  }
  50%{
    opacity:.85;
    transform:translateY(-50%) rotate(-1.2deg) scale(1.04);
    filter:blur(1.6px) saturate(1.15) brightness(1.08);
  }
  100%{
    opacity:.5;
    transform:translateY(-50%) rotate(-1.2deg) scale(1);
    filter:blur(1px) saturate(1.05) brightness(1);
  }
}
.total.glow::before{
  animation: glowPulse 1.8s var(--ease) 1;
}
.total-note{
  margin-top:6px;
  font-size:11px;
  color:#6a7a8a;
  letter-spacing:.08em;
  max-width:520px;
  margin-left:auto;
  margin-right:auto;
  text-align:center;
}

/* ===== 匯款資訊卡片 ===== */
.account-box{
  width:85%;
  max-width:360px;
  margin:26px auto 0;
  background:rgba(255,255,255,0.88);
  -webkit-backdrop-filter:blur(11px) brightness(1.04);
  backdrop-filter:blur(11px) brightness(1.04);
  border:none;
  color:#333;
  padding:16px 16px 18px;
  border-radius:16px;
  font-size:13px;
  box-shadow:0 10px 26px rgba(0,0,0,0.07);
  text-align:left;
}
.account-box h3{
  margin:4px 0 10px;
  font-weight:600;
  font-size:15px;
  color:#44566C;
  letter-spacing:.5px;
}

/* 複製按鈕置中 */
#copyBtn{
  display:block;
  margin:10px auto 0;
}

/* ===== 按鈕 ===== */
.btn{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:11px 20px;
  border-radius:999px;
  border:1px solid transparent;
  font:600 15px 'Noto Serif TC','Microsoft JhengHei',serif;
  letter-spacing:.12em;
  cursor:pointer;
  user-select:none;
  transition:
    transform .18s var(--ease),
    box-shadow .28s var(--ease),
    background-color .18s var(--ease),
    border-color .18s var(--ease),
    filter .18s;
}
.btn:hover{ transform:translateY(-1px); }
.btn:active{ transform:translateY(0); }
.btn:focus-visible{
  outline:2px solid rgba(30,79,123,.4);
  outline-offset:2px;
}

/* 蠟筆塊底 */
.btn-crayon{
  color:#fff;
  background:var(--crayon-blue);
  border:1px solid var(--crayon-blue-ink);
  border-radius:22px 20px 24px 21px / 21px 24px 20px 22px;
  box-shadow:
    0 8px 18px rgba(60,81,104,.22),
    inset 0 1px 0 rgba(255,255,255,.18);
  position:relative;
  overflow:hidden;
}
.btn-crayon::before{
  content:"";
  position:absolute;
  inset:0;
  opacity:.16;
  pointer-events:none;
  background:
    repeating-linear-gradient(14deg, rgba(255,255,255,.09) 0 2px, rgba(255,255,255,0) 2px 6px),
    repeating-linear-gradient(-10deg, rgba(0,0,0,.04) 0 1px, rgba(0,0,0,0) 1px 5px);
}
.btn-crayon:hover{
  filter:brightness(1.06) saturate(1.02);
}

/* 手繪描邊 */
.btn-sketch{
  color:var(--navy);
  background:transparent;
  border:2px solid var(--navy);
  border-radius:22px 18px 24px 20px / 20px 24px 18px 22px;
  box-shadow:0 2px 0 rgba(30,79,123,.08);
  position:relative;
}
.btn-sketch::after{
  content:"";
  position:absolute;
  inset:3px;
  border-radius:inherit;
  border:1px dashed rgba(30,79,123,.45);
  pointer-events:none;
}
.btn-sketch:hover{ filter:brightness(1.02); }

/* ===== 提示字 ===== */
#formReminder{
  font-size:13.5px;
  color:#555;
  margin-top:16px;
  opacity:0;
  transform:translateY(14px);
  transition:
    opacity .8s var(--ease),
    transform .8s var(--ease);
  letter-spacing:.12em;
}
#formReminder.in{
  opacity:1;
  transform:translateY(0);
}

/* ===== Toast ===== */
.toast{
  position:fixed;
  left:50%;
  bottom:22px;
  transform:translateX(-50%) translateY(20px);
  min-width:260px;
  max-width:92vw;
  color:#1E4F7B;
  background:rgba(255,255,255,.88);
  border:1px solid rgba(30,79,123,.18);
  border-radius:12px;
  padding:12px 16px;
  font-size:14px;
  font-weight:600;
  -webkit-backdrop-filter: blur(12px) saturate(1.1);
  backdrop-filter: blur(12px) saturate(1.1);
  box-shadow:
    0 10px 24px rgba(0,0,0,0.12),
    inset 0 1px 0 rgba(255,255,255,.6);
  opacity:0;
  pointer-events:none;
  z-index:99999;
  transition:
    opacity .5s var(--ease),
    transform .5s var(--ease);
}
.toast::before{
  content:"";
  position:absolute;
  left:0;
  top:0;
  bottom:0;
  width:6px;
  border-top-left-radius:12px;
  border-bottom-left-radius:12px;
  background:linear-gradient(180deg, #3a6aa1, #1E4F7B);
  box-shadow:0 0 0 1px rgba(30,79,123,.18) inset;
}
.toast.show{
  opacity:1;
  transform:translateX(-50%) translateY(0);
}

/* footer 小字 */
.footer-note{
  margin-top:40px;
  font-size:11px;
  color:#8a8a84;
  letter-spacing:.08em;
  text-align:left;
}

/* ===== 開賣提示 Modal ===== */
.promo-modal-backdrop{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.16);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:9998;
  opacity:0;
  pointer-events:none;
  transition:opacity .4s var(--ease);
}
.promo-modal-backdrop.show{
  opacity:1;
  pointer-events:auto;
}
.promo-modal{
  position:relative;
  max-width:320px;
  width:80%;
  padding:18px 18px 16px;
  border-radius:18px;
  background:rgba(248,245,238,.96);
  border:1px solid rgba(151,147,135,.45);
  box-shadow:
    0 14px 30px rgba(0,0,0,.22),
    inset 0 1px 0 rgba(255,255,255,.8);
  -webkit-backdrop-filter:blur(16px) saturate(1.05);
  backdrop-filter:blur(16px) saturate(1.05);
  text-align:left;
  color:#3a3a34;
  transform:translateY(8px) scale(.96);
  opacity:0;
  transition:
    opacity .4s var(--ease),
    transform .4s var(--ease);
}
.promo-modal-backdrop.show .promo-modal{
  opacity:1;
  transform:translateY(0) scale(1);
}
.promo-label{
  font-size:11px;
  letter-spacing:.22em;
  text-transform:uppercase;
  color:#8b806e;
  margin-bottom:6px;
}
.promo-modal h3{
  margin:0 0 6px;
  font-size:18px;
  letter-spacing:.14em;
}
.promo-main{
  font-size:13px;
  line-height:1.7;
  letter-spacing:.12em;
  color:#4b4b44;
}
.promo-main strong{
  color:#A6413C;
  font-weight:700;
}
.promo-sub{
  margin-top:6px;
  font-size:11px;
  color:#8d8c82;
  letter-spacing:.14em;
}
.promo-close{
  position:absolute;
  right:10px;
  top:8px;
  width:26px;
  height:26px;
  border-radius:999px;
  border:none;
  background:transparent;
  color:#7a746a;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:18px;
  line-height:1;
  padding:0;
  transition:background-color .2s var(--ease), transform .15s var(--ease), color .2s var(--ease);
}
.promo-close:hover{
  background:rgba(0,0,0,.04);
  color:#555149;
}
.promo-close:active{
  transform:scale(.96);
}

/* ===== 手機優化 ===== */
@media (max-width:480px){
  :root{
    --qty-btn-w: 30px;
    --qty-disp-w: 44px;
  }
  .page-inner{
    padding:0 16px 36px;
  }
  h2{
    font-size:60px;
    margin-top:22px;
    letter-spacing:.03em;
  }
  .brand-tagline{
    font-size:13px;
    letter-spacing:.3em;
  }
  .promo-inline{
    font-size:12px;
    width:100%;
    letter-spacing:.16em;
  }
  .section-title{
    font-size:13.5px;
    letter-spacing:.16em;
  }
  table{
    font-size:14px;
    width:96%;
  }
  #productTable td:first-child{
    font-size:15px;
  }
  #productTable td:first-child small{
    font-size:12px;
  }
  .col-item{  width:46%; }
  .col-price{ width:20%; }
  .col-action{ width:34%; }

  .ship-wrap{
    width:96%;
    gap:6px;
    flex-wrap:nowrap;
  }
  .ship-card{
    flex:1 1 0;
    max-width:none;
    padding:9px 4px 8px;
  }
  .ship-title{
    font-size:13px;
    letter-spacing:.12em;
  }
  .ship-price{
    font-size:13px;
  }
  .input-container{
    width:100%;
    padding:18px 18px 20px;
  }
  .account-box{
    width:86%;
    font-size:12.5px;
  }
  .btn{
    padding:8px 16px;
    font-size:13px;
    letter-spacing:.13em;
  }

  #intro{
    padding-top:10vh;
  }
  #intro-logo{
    width:clamp(260px, 70vw, 420px);
  }
  #intro-hero{
    width:clamp(240px, 68vw, 360px);
    margin:14px auto -66px;
  }
  #intro-text{
    margin-top:-34px;
    line-height:1.9;
  }
  #intro-hero-panel{
    padding:8vh 16px 6vh;
  }
  .hero-overlay{
    padding:16px 16px 18px;
  }
  .hero-title{
    font-size:22px;
  }
  .hero-sub{
    font-size:12.5px;
    max-width:280px;
  }
  #startBtn .btn-main-en,
  #storyBtn .btn-main-en{
    font-size:16px;
  }
  #startBtn .btn-sub-zh,
  #storyBtn .btn-sub-zh{
    font-size:11.5px;
  }
}

/* ===== 無動化偏好 ===== */
@media (prefers-reduced-motion: reduce){
  *{ animation:none !important; transition:none !important; }
  #startBtn::after,
  #storyBtn::after{ display:none !important; }
}
</style>
</head>

<body>
<!-- ===== 開場 ===== -->
<div id="intro">
  <!-- Stage 1：Logo -->
  <img id="intro-logo" decoding="async" loading="eager"
       src="https://raw.githubusercontent.com/b02279437-crypto/liu-mama-calculator/main/logo.png" alt="Logo">

  <!-- Stage 2：原先文字頁（LOGO2 + 故事文字，沒有按鈕） -->
  <img id="intro-hero" decoding="async" loading="eager"
       src="https://raw.githubusercontent.com/b02279437-crypto/liu-mama-calculator/main/LOGO2-removebg-preview.png" alt="Liu Mama Secondary Logo">

  <div id="intro-text">
2015年遠赴四川成都， 
學習正宗麻辣鍋底與紅油煉製。
手工慢炒堆疊香氣，濃郁而不膩。

劉嘛麻，一鍋來自初心的麻辣香氣，
陪你溫暖每一餐。
  </div>

  <!-- Stage 3：Hero 產品照 + 按鈕 -->
  <div id="intro-hero-panel">
    <div class="hero-frame">
      <img class="hero-image" decoding="async" loading="eager"
           src="https://raw.githubusercontent.com/b02279437-crypto/liu-mama-calculator/main/product-2"
           alt="Liu Mama 麻辣鍋底產品照">
      <div class="hero-overlay">
        <div class="hero-eyebrow">LIU MAMA </div>
        <div class="hero-title">手炒麻辣鍋底 · 開賣中</div>
        <div class="hero-sub">
          手炒的麻辣，暖心又暖胃。<br>
        
        </div>
        <div class="hero-actions">
          <button id="startBtn">
            <span class="btn-main-en">STAR ORDER</span>
            <span class="btn-sub-zh">開始訂購</span>
          </button>
          <button id="storyBtn">
            <span class="btn-main-en">PRODUCT STORY</span>
            <span class="btn-sub-zh">產品介紹</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ===== 主內容 ===== -->
<main id="mainContent" aria-describedby="formReminder">
  <div class="page-inner">
    <h2 id="pageTitle"><span class="english">LIU MAMA Order</span></h2>

    <!-- 標語 ＋ 優惠區 -->
    <div class="brand-block">
      <p class="brand-tagline">
        手炒的麻辣，暖心又暖胃
      </p>
      <p id="promoInline" class="promo-inline">
        <span class="promo-mark">⛧</span>
        11/18 ~ 12/18 開賣價
        <strong class="price-red">$299</strong>
        <span class="promo-sep">·</span>
        倒數 <strong class="promo-days" id="promoDays">-- 天</strong>
      </p>
    </div>

    <section class="reveal">
      <p class="section-title">請填寫訂購人資訊</p>
      <div class="input-container">
        <div class="input-group">
          <label for="customerName">訂購人姓名</label>
          <input type="text" id="customerName" placeholder="請輸入姓名"
                 autocomplete="name" enterkeyhint="next">
          <small class="error-hint" id="errName" hidden></small>
        </div>
        <div class="input-group">
          <label for="customerPhone">訂購人電話</label>
          <input type="text" id="customerPhone" placeholder="請輸入電話"
                 inputmode="numeric" pattern="[0-9]*" maxlength="10" enterkeyhint="next" autocomplete="tel">
          <small class="error-hint" id="errPhone" hidden></small>
        </div>
        <div class="input-group">
          <label for="customerEmail">訂購人 Email</label>
          <input type="email" id="customerEmail" placeholder="請輸入 Email"
                 autocomplete="email" enterkeyhint="done" inputmode="email" list="emailHints">
          <datalist id="emailHints"></datalist>
          <small class="error-hint" id="errEmail" hidden></small>
        </div>
      </div>
    </section>

    <section class="reveal">
      <p class="section-title">請選擇購買數量與寄送方式，系統將自動計算金額</p>

      <table id="productTable">
        <colgroup>
          <col class="col-item"><col class="col-price"><col class="col-action">
        </colgroup>
        <tr><th>品項</th><th>價格</th><th>數量</th></tr>
        <tr>
          <td>麻辣底料包<br><small>(2人份)</small></td>
          <td>
            <div class="price-cell">
              <span class="price-old">$320</span>
              <span class="price-new">$299</span>
            </div>
          </td>
          <td>
            <div class="qty-stepper" role="group" aria-label="數量">
              <button type="button" class="qty-btn" id="qtyMinus" aria-label="減少">−</button>
              <input id="qtyInput" class="qty-input" type="text" inputmode="numeric" pattern="[0-9]*" maxlength="2"
                     value="0" role="spinbutton" aria-valuemin="0" aria-valuemax="35" aria-valuenow="0" aria-live="polite">
              <button type="button" class="qty-btn" id="qtyPlus" aria-label="增加">＋</button>
            </div>
            <select id="qty1" onchange="calculate()" aria-label="數量" hidden></select>
          </td>
        </tr>
      </table>
    </section>

    <!-- 寄送方式 -->
    <section class="reveal">
      <div class="ship-wrap" role="radiogroup" aria-label="寄送方式">
        <label class="ship-card" for="ship711">
          <input type="radio" name="shipMethod" id="ship711" value="711">
          <div class="ship-title">711取貨</div>
          <div class="ship-price">$60</div>
        </label>
        <label class="ship-card" for="shipPost">
          <input type="radio" name="shipMethod" id="shipPost" value="post">
          <div class="ship-title">宅配到家</div>
          <div class="ship-price">$120</div>
        </label>
        <label class="ship-card" for="shipPickup">
          <input type="radio" name="shipMethod" id="shipPickup" value="pickup">
          <div class="ship-title">自取</div>
          <div class="ship-price">$0</div>
        </label>
      </div>

      <p id="pickupNote" class="pickup-note" hidden>
        自取地點：<br><br>
        ① 【食實甜點工作室】<br>
        台北市士林區天母北路47號1F<br>
        <span style="opacity:.8;">（天母商圈）</span><br><br>
        ② 【Kuki House 軟餅乾專店】<br>
        台北市大同區太原路97巷8號1樓<br>
        <span style="opacity:.8;">（近承德路、京站）</span>
      </p>

      <div class="total" id="total" role="status" aria-live="polite" aria-atomic="true">Total Amount: $0</div>
      <div class="total-note">金額已含寄送費用 · 單位：新台幣</div>
    </section>

    <!-- 匯款資訊 + 按鈕 -->
    <section class="reveal">
      <div class="account-box">
        <h3>請匯款至以下帳戶:</h3>
        <p>824 連線商業銀行　帳號：<span id="accountNumber">  111021686628  </span></p>
        <button id="copyBtn" class="btn btn-crayon" onclick="copyAccount()">複製匯款帳號</button>
      </div>

      <div id="buttonContainer" style="display:flex; justify-content:center; gap:12px; flex-wrap:wrap; margin-top:32px;">
        <button id="screenshotBtn" class="btn btn-crayon" onclick="screenshotOrder()">保存訂單截圖</button>
        <button id="formBtn" class="btn btn-sketch" onclick="goToForm()">下一步：填寫寄送資訊</button>
      </div>
      <p id="formReminder">煩請先匯款後，一定要按「下一步」填寫寄送資訊！</p>

      <div class="footer-note">
        © LIU MAMA 2015–2025 · Handcrafted spicy mala hot pot
      </div>
    </section>
  </div>
</main>

<!-- 開賣提示 Modal -->
<div id="launchModal" class="promo-modal-backdrop" aria-hidden="true">
  <div class="promo-modal" role="dialog" aria-modal="true" aria-labelledby="launchTitle">
    <button type="button" class="promo-close" id="launchClose" aria-label="關閉">
      ×
    </button>
    <div class="promo-label">LIU MAMA</div>
    <h3 id="launchTitle">劉嘛麻 開賣啦&nbsp;.ᐟ.ᐟ</h3>

    <p class="promo-main">
      手炒麻辣鍋底<br>
      11/18 ~ 12/18 開賣價 <strong>$299</strong><br>
      期間限定價 · 先嚐一鍋就愛上
    </p>

    <p class="promo-sub">
      四川改良 &emsp;×&emsp; 十三融香 &emsp;×&emsp; 香麻登場
    </p>
  </div>
</div>

<!-- Toast -->
<div id="toast" class="toast" aria-live="polite" aria-atomic="true"></div>

<script>
/* ===== 圖片載入 ===== */
function imgReady(el){
  if(el && el.complete){
    if('decode' in el){ return el.decode().catch(()=>{}); }
  } else if(el){
    return new Promise(res=>{
      el.addEventListener('load', res, {once:true});
      el.addEventListener('error', res, {once:true});
    });
  }
  return Promise.resolve();
}

/* ===== 新版開場流程：Logo → 原文字頁 → Hero 產品照＋按鈕 ===== */
async function startIntroSequence(){
  const logo      = document.getElementById('intro-logo');   // Stage 1
  const hero      = document.getElementById('intro-hero');   // Stage 2 圖
  const text      = document.getElementById('intro-text');   // Stage 2 文
  const heroPanel = document.getElementById('intro-hero-panel'); // Stage 3
  const btn       = document.getElementById('startBtn');
  const storyBtn  = document.getElementById('storyBtn');

  const maxWait = new Promise(r=>setTimeout(r,4000));
  await Promise.race([Promise.all([imgReady(logo), imgReady(hero)]), maxWait]);

  const STAGE_SWITCH = 3200; // Logo→文字頁的切換時間
  const FADE_TIME    = 2000; // Logo / 文字頁淡出秒數

  requestAnimationFrame(()=>{
    if(!logo) return;

    /* Stage 1：Logo 淡入 */
    logo.classList.add('show');

    /* Logo 淡出 */
    setTimeout(()=>{ logo.classList.add('hide'); }, FADE_TIME);

    /* Stage 2：文字頁（LOGO2 + 故事文字，沒有按鈕） */
    setTimeout(()=>{
      logo.style.display='none';
      if(hero) hero.classList.add('show');
      if(text) text.classList.add('show');
    }, STAGE_SWITCH);

    /* Stage 2 淡出（秒數跟 Logo 一樣） */
    setTimeout(()=>{
      if(hero) hero.classList.remove('show');
      if(text) text.classList.remove('show');
    }, STAGE_SWITCH + FADE_TIME);

    /* Stage 3：Hero 產品照 + 按鈕 */
    setTimeout(()=>{
      if(hero){
        hero.style.display='none';
      }
      if(text){
        text.style.display='none';
      }
      if(heroPanel){
        heroPanel.classList.add('show');
      }
      setTimeout(()=>{
        if(btn) btn.classList.add('show');
        if(storyBtn) storyBtn.classList.add('show');
      }, 400);
    }, STAGE_SWITCH + STAGE_SWITCH); // 文字頁顯示時間大約同 Logo
  });
}

/* ===== scroll reveal ===== */
function setupRevealOnScroll(){
  const reveals=document.querySelectorAll('.reveal');
  if(!reveals.length) return;

  const fr=document.getElementById('formReminder');

  if(!('IntersectionObserver' in window)){
    reveals.forEach(el=>el.classList.add('in'));
    if(fr) fr.classList.add('in');
    return;
  }

  const io=new IntersectionObserver((entries)=>{
    entries.forEach(entry=>{
      const el=entry.target;
      if(entry.isIntersecting){
        el.classList.add('in');
        if(fr && el.contains(fr)) fr.classList.add('in');
      }else{
        el.classList.remove('in');
        if(fr && el.contains(fr)) fr.classList.remove('in');
      }
    });
  },{threshold:0.18});

  reveals.forEach(el=>io.observe(el));
}

/* ===== 開賣 Modal 控制 ===== */
let launchModalTimer = null;

function showLaunchModal(){
  const backdrop = document.getElementById('launchModal');
  if(!backdrop) return;
  backdrop.classList.add('show');
  backdrop.setAttribute('aria-hidden','false');

  if(launchModalTimer) clearTimeout(launchModalTimer);
  launchModalTimer = setTimeout(hideLaunchModal, 7000);
}
function hideLaunchModal(){
  const backdrop = document.getElementById('launchModal');
  if(!backdrop) return;
  backdrop.classList.remove('show');
  backdrop.setAttribute('aria-hidden','true');
}

/* ===== 初始化 ===== */
window.addEventListener('DOMContentLoaded',()=>{
  // 讀取網址參數，判斷是否要跳過開場動畫
  const params = new URLSearchParams(window.location.search);
  const skipIntro = params.get('skipIntro') === '1';

  const select=document.getElementById('qty1');
  for(let i=0;i<=35;i++){
    const o=document.createElement('option');
    o.value=i;
    o.textContent=i;
    select.appendChild(o);
  }
  select.value="0";

  buildQty();
  calculate(true);

  const intro=document.getElementById('intro');
  const btn=document.getElementById('startBtn');
  const storyBtn=document.getElementById('storyBtn');
  const main=document.getElementById('mainContent');
  const pageTitle=document.getElementById('pageTitle');

  if(skipIntro){
    // ✅ 帶 ?skipIntro=1：直接顯示主畫面
    if(intro){
      intro.classList.add('fade-out');
      intro.style.display='none';
    }
    if(main){
      main.classList.add('show');
    }
    if(pageTitle){
      pageTitle.classList.add('title-in');
    }
    setupRevealOnScroll();
    showLaunchModal();
  }else{
    // 開場動畫：Logo → 原文字頁 → Hero 產品照
    startIntroSequence();

    if(btn){
      btn.addEventListener('click',(e)=>{
        triggerRipple(e);
        intro.classList.add('fade-out');
        setTimeout(()=>{
          intro.style.display='none';
          main.classList.add('show');
          if(pageTitle){ pageTitle.classList.add('title-in'); }

          setupRevealOnScroll();
          showLaunchModal();
        },600);
      });
    }
  }

  // PRODUCT STORY 按鈕：導去產品介紹頁
  if(storyBtn){
    storyBtn.addEventListener('click',(e)=>{
      triggerRipple(e);
      window.location.href='https://b02279437-crypto.github.io/liu-mama-calculator/product.html';
    });
  }

  const pickupNote = document.getElementById('pickupNote');

  document.querySelectorAll('.ship-card input').forEach(r=>{
    r.addEventListener('change', ()=>{
      calculate();
      document.querySelectorAll('.ship-card').forEach(card=>{
        const input=card.querySelector('input');
        card.classList.toggle('selected', input.checked);
      });

      if(pickupNote){
        const method=document.querySelector('input[name="shipMethod"]:checked');
        if(method && method.value==='pickup'){
          pickupNote.hidden=false;
          pickupNote.classList.add('show');
        }else{
          pickupNote.classList.remove('show');
          pickupNote.hidden=true;
        }
      }
    });
  });

  setupInlinePromo();

  const nameInput  = document.getElementById('customerName');
  const phoneInput = document.getElementById('customerPhone');
  const emailInput = document.getElementById('customerEmail');

  nameInput.addEventListener('keydown', (e)=>{
    if(e.key === 'Enter'){ e.preventDefault(); phoneInput.focus(); }
  });
  phoneInput.addEventListener('keydown', (e)=>{
    if(e.key === 'Enter'){ e.preventDefault(); emailInput.focus(); }
  });

  nameInput.addEventListener('change', ()=>{
    if (nameInput.value.trim().length >= 1) phoneInput.focus();
  });
  phoneInput.addEventListener('change', ()=>{
    const digits = phoneInput.value.replace(/\D/g,'');
    if (digits.length >= 10) emailInput.focus();
  });

  enableEmailAutoSuggest();

  const launchBackdrop = document.getElementById('launchModal');
  const launchCloseBtn = document.getElementById('launchClose');

  if(launchBackdrop){
    launchBackdrop.addEventListener('click',(e)=>{
      if(e.target === launchBackdrop){
        hideLaunchModal();
      }
    });
  }
  if(launchCloseBtn){
    launchCloseBtn.addEventListener('click',()=>{
      hideLaunchModal();
    });
  }
  document.addEventListener('keydown',(e)=>{
    if(e.key === 'Escape'){
      hideLaunchModal();
    }
  });
});

/* ===== Email 智慧建議 ===== */
const COMMON_DOMAINS = [
  'gmail.com',
  'yahoo.com.tw',
  'yahoo.com',
  'hotmail.com'
];
function enableEmailAutoSuggest(){
  const emailInput = document.getElementById('customerEmail');
  const listEl     = document.getElementById('emailHints');
  if(!emailInput || !listEl) return;

  function rebuildOptions(){
    const raw = (emailInput.value || '').trim();
    const atIndex = raw.indexOf('@');
    const local   = atIndex >= 0 ? raw.slice(0, atIndex) : raw;
    const prefix  = atIndex >= 0 ? raw.slice(atIndex + 1).toLowerCase() : '';

    if(!local){
      listEl.innerHTML = '';
      return;
    }

    const candidates = COMMON_DOMAINS
      .filter(d => d.startsWith(prefix))
      .slice(0, 8);

    listEl.innerHTML = '';
    for(const d of candidates){
      const opt = document.createElement('option');
      opt.value = `${local}@${d}`;
      listEl.appendChild(opt);
    }
  }

  emailInput.addEventListener('input', rebuildOptions);
  emailInput.addEventListener('change', rebuildOptions);

  emailInput.addEventListener('keydown', (e)=>{
    if(e.altKey && /^[1-9]$/.test(e.key)){
      const idx = Number(e.key) - 1;
      const opt = listEl.children[idx];
      if(opt){
        e.preventDefault();
        emailInput.value = opt.value;
        emailInput.dispatchEvent(new Event('change', {bubbles:true}));
      }
    }
  });
}

/* ===== 倒數天數 ===== */
function setupInlinePromo(){
  const daysEl = document.getElementById('promoDays');
  if(!daysEl) return;

  try{
    const now   = new Date();
    const year  = now.getFullYear();
    const today = new Date(year, now.getMonth(), now.getDate());
    const end   = new Date(year, 11, 18); // 12/18

    const MS = 24*60*60*1000;
    let diffDays = Math.round((end - today) / MS);
    if(diffDays < 0) diffDays = 0;

    animatePromoNumber(daysEl, diffDays);
  }catch(err){
    daysEl.textContent = '— 天';
  }
}

function animatePromoNumber(el, target){
  if(!el) return;
  let from = parseInt((el.textContent||'').replace(/[^\d]/g,''),10);
  if(isNaN(from)) from = 0;

  const duration = 900;
  const t0 = performance.now();
  const ease = t => 1 - Math.pow(1 - t, 3);

  function frame(now){
    const p = Math.min(1, (now - t0) / duration);
    const v = Math.max(0, Math.round(from + (target - from) * ease(p)));
    el.textContent = v + ' 天';
    if(p < 1){ requestAnimationFrame(frame); }
  }
  el.classList.remove('animate'); void el.offsetWidth; el.classList.add('animate');
  requestAnimationFrame(frame);
}

/* ===== Stepper（0–35、±1、含長按連續） ===== */
function buildQty(){
  const MIN=0, MAX=35;
  const select = document.getElementById('qty1');
  const minus  = document.getElementById('qtyMinus');
  const plus   = document.getElementById('qtyPlus');
  const input  = document.getElementById('qtyInput');

  function clamp(n){
    n = Number(n);
    if(Number.isNaN(n)) n = 0;
    return Math.min(MAX, Math.max(MIN, n|0));
  }
  function syncTo(val, trigger=true){
    const v = clamp(val);
    if(select.value !== String(v)) select.value = String(v);
    if(input.value  !== String(v)) input.value  = String(v);
    input.setAttribute('aria-valuenow', String(v));
    if(trigger) calculate();
  }
  function setupClick(btn, delta){
    btn.addEventListener('click', (e)=>{
      if(btn._holdTriggered){
        e.preventDefault();
        btn._holdTriggered = false;
        return;
      }
      syncTo(Number(select.value)+delta);
    });
  }
  setupClick(minus,-1);
  setupClick(plus, 1);

  function setupHold(btn, delta){
    let tDelay, tRepeat;
    const step=()=> syncTo(Number(select.value)+delta);
    const start = (e)=>{
      btn._holdTriggered=false;
      tDelay=setTimeout(()=>{
        step();
        btn._holdTriggered = true;
        tRepeat=setInterval(step, 70);
      }, 350);
      btn.setPointerCapture?.(e.pointerId);
    };
    const stop = ()=>{
      clearTimeout(tDelay);
      clearInterval(tRepeat);
    };
    btn.addEventListener('pointerdown', start);
    btn.addEventListener('pointerup', stop);
    btn.addEventListener('pointercancel', stop);
    btn.addEventListener('pointerleave', stop);
  }
  setupHold(minus,-1);
  setupHold(plus, 1);

  input.addEventListener('keydown', (e)=>{
    const v = Number(select.value);
    if(['ArrowUp','ArrowRight'].includes(e.key)){ e.preventDefault(); syncTo(v+1); }
    else if(['ArrowDown','ArrowLeft'].includes(e.key)){ e.preventDefault(); syncTo(v-1); }
    else if(e.key==='Home'){ e.preventDefault(); syncTo(MIN); }
    else if(e.key==='End'){ e.preventDefault(); syncTo(MAX); }
    else if(e.key==='PageUp'){ e.preventDefault(); syncTo(v+5); }
    else if(e.key==='PageDown'){ e.preventDefault(); syncTo(v-5); }
  });
  input.addEventListener('input', ()=>{
    input.value = input.value.replace(/[^0-9]/g,'').slice(0,2);
    const v = input.value==='' ? 0 : clamp(input.value);
    syncTo(v, true);
  });
  input.addEventListener('blur', ()=>{
    syncTo(input.value==='' ? 0 : input.value, true);
  });

  syncTo(select.value||0, false);
}

/* ===== 計算金額 ===== */
let lastTotal=0;
function calculate(isInit){
  const qty1=parseInt(document.getElementById('qty1').value)||0;
  let ship=0;
  const method=document.querySelector('input[name="shipMethod"]:checked');
  if(method){
    if(method.value==='711') ship=60;
    else if(method.value==='post') ship=120;
    else if(method.value==='pickup') ship=0;
  }
  const newTotal=qty1*299+ship;
  animateTotal(newTotal, !!isInit);
}
function animateTotal(target, isInit){
  const el=document.getElementById('total');
  if(isInit){
    lastTotal=target;
    el.textContent='Total Amount: $'+target;
    el.classList.add('show');
    return;
  }
  el.classList.remove('animate','glow');
  void el.offsetWidth;
  el.classList.add('animate','glow');
  if(window.matchMedia('(prefers-reduced-motion: reduce)').matches){
    lastTotal=target;
    el.textContent='Total Amount: $'+target;
    return;
  }
  const dur=900;
  const t0=performance.now();
  const from=lastTotal;
  const d=target-from;
  const ease=t=>1-Math.pow(1-t,3);
  function frame(now){
    const p=Math.min(1,(now-t0)/dur);
    const v=Math.round(from+d*ease(p));
    el.textContent='Total Amount: $'+v;
    if(p<1){
      requestAnimationFrame(frame);
    }else{
      lastTotal=target;
    }
  }
  requestAnimationFrame(frame);
}

/* ===== 複製帳號／截圖／送表單 ===== */
function copyAccount(){
  const acct=document.getElementById('accountNumber').innerText;
  if(navigator.clipboard && window.isSecureContext){
    navigator.clipboard.writeText(acct).then(()=>{
      showToast('匯款帳號已複製，完成匯款後請按下一步填寫寄送資訊。');
    }).catch(()=>alert('匯款帳號已複製！'));
  }else{
    const ta=document.createElement('textarea');
    ta.value=acct;
    document.body.appendChild(ta);
    ta.select();
    document.execCommand('copy');
    document.body.removeChild(ta);
    showToast('匯款帳號已複製，完成匯款後請按下一步填寫寄送資訊。');
  }
}
function screenshotOrder(){
  const target=document.getElementById('mainContent');
  if(typeof html2canvas==='undefined'){
    alert('截圖功能庫尚未載入，請稍後再試或檢查網路連線。');
    return;
  }
  html2canvas(target).then(canvas=>{
    const link=document.createElement('a');
    link.href=canvas.toDataURL('image/png');
    link.download='liu_mama_order.png';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    showToast('截圖已下載！記得填寫表單喔。');
  }).catch(()=>alert('截圖失敗，請再試一次'));
}
function showToast(msg){
  const el=document.getElementById('toast');
  if(!el){
    alert(msg);
    return;
  }
  el.textContent=msg;
  el.classList.add('show');
  clearTimeout(showToast._t);
  showToast._t=setTimeout(()=>el.classList.remove('show'),2200);
}
function setFieldError(el, id, msg){
  const hint=document.getElementById(id);
  if(msg){
    el.classList.add('input-error');
    el.setAttribute('aria-invalid','true');
    hint.textContent=msg;
    hint.hidden=false;
  }else{
    el.classList.remove('input-error');
    el.setAttribute('aria-invalid','false');
    hint.textContent='';
    hint.hidden=true;
  }
}
function goToForm(){
  const name  = document.getElementById('customerName');
  const phone = document.getElementById('customerPhone');
  const email = document.getElementById('customerEmail');
  const qty   = parseInt(document.getElementById('qty1').value)||0;
  const method= document.querySelector('input[name="shipMethod"]:checked');

  let ok=true;
  setFieldError(name,'errName','');
  setFieldError(phone,'errPhone','');
  setFieldError(email,'errEmail','');

  if(!name.value.trim()){
    setFieldError(name,'errName','請輸入訂購人姓名');
    ok=false;
  }
  if(!phone.value.trim()){
    setFieldError(phone,'errPhone','請輸入訂購人電話');
    ok=false;
  }else if(!/^\d{10}$/.test(phone.value.trim())){
    setFieldError(phone,'errPhone','電話需為 10 碼數字');
    ok=false;
  }
  if(!email.value.trim()){
    setFieldError(email,'errEmail','請輸入 Email');
    ok=false;
  }else if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email.value.trim())){
    setFieldError(email,'errEmail','Email 格式不正確');
    ok=false;
  }

  if(qty<=0){
    showToast('請選擇購買數量');
    ok=false;
  }
  if(!method){
    showToast('請選擇寄送方式');
    ok=false;
  }
  if(!ok) return;

  let shipLabel='';
  if(method.value==='711') shipLabel='711取貨';
  else if(method.value==='post') shipLabel='宅配到家';
  else if(method.value==='pickup') shipLabel='自取';

  const total = qty*299 + (method.value==='711' ? 60 : method.value==='post' ? 120 : 0);

  const base = 'https://docs.google.com/forms/d/e/1FAIpQLScXsrY_3yROVmqR3sa-WecBs4y8wKeZuPLSM0QNgy602xEWJA/viewform?usp=pp_url';
  const formUrl = base
    + `&entry.1152845848=${encodeURIComponent(name.value.trim())}`
    + `&entry.178268335=${encodeURIComponent(phone.value.trim())}`
    + `&entry.441082214=${encodeURIComponent(email.value.trim())}`
    + `&entry.1732058404=${qty}`
    + `&entry.509305715=${encodeURIComponent(shipLabel)}`
    + `&entry.1351577488=${encodeURIComponent(total)}`;
  window.open(formUrl,'_blank');
}

/* ===== Ripple ===== */
function triggerRipple(e){
  const btn=e.currentTarget;
  const rect=btn.getBoundingClientRect();
  btn.style.setProperty('--rx',(e.clientX-rect.left)+'px');
  btn.style.setProperty('--ry',(e.clientY-rect.top)+'px');
  btn.classList.remove('rippling');
  void btn.offsetWidth;
  btn.classList.add('rippling');
}
document.addEventListener('keydown',(e)=>{
  if(e.key==='Enter'){
    const btn=document.getElementById('startBtn');
    if(document.activeElement===btn){
      const r=btn.getBoundingClientRect();
      triggerRipple({
        currentTarget:btn,
        clientX:r.left+r.width/2,
        clientY:r.top+r.height/2
      });
    }
  }
});
</script>
</body>
</html>
